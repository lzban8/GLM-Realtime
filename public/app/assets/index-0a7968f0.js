var Zt=Object.defineProperty;var Xt=(t,e,n)=>e in t?Zt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var L=(t,e,n)=>(Xt(t,typeof e!="symbol"?e+"":e,n),n);import{r as O,o as C,c as ee,s as $t,u as Ee,a as en,n as tn,d as xt,b as nn,i as Ae,e as z,h as Rt,p as Qe,f as sn,w as on,g as R,j as rn,k as m,l as _e,v as Se,m as K,q as k,t as F,x as H,F as se,y as Ie,z as y,A as an,B as v,C as ln,D as cn,E as un}from"./element-plus-3a75fdd9.js";import{u as dn}from"./wavesurfer-557fdf25.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const Y=(t,e)=>{const n=t.__vccOpts||t;for(const[o,s]of e)n[o]=s;return n},hn={name:"App"};function fn(t,e,n,o,s,i){const r=O("router-view");return C(),ee(r)}const pn=Y(hn,[["render",fn]]);/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const ae=typeof document<"u";function Ot(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function mn(t){return t.__esModule||t[Symbol.toStringTag]==="Module"||t.default&&Ot(t.default)}const T=Object.assign;function Fe(t,e){const n={};for(const o in e){const s=e[o];n[o]=W(s)?s.map(t):t(s)}return n}const ve=()=>{},W=Array.isArray,It=/#/g,gn=/&/g,_n=/\//g,Sn=/=/g,En=/\?/g,Tt=/\+/g,vn=/%5B/g,yn=/%5D/g,Dt=/%5E/g,An=/%60/g,Pt=/%7B/g,Cn=/%7C/g,Bt=/%7D/g,wn=/%20/g;function qe(t){return encodeURI(""+t).replace(Cn,"|").replace(vn,"[").replace(yn,"]")}function bn(t){return qe(t).replace(Pt,"{").replace(Bt,"}").replace(Dt,"^")}function We(t){return qe(t).replace(Tt,"%2B").replace(wn,"+").replace(It,"%23").replace(gn,"%26").replace(An,"`").replace(Pt,"{").replace(Bt,"}").replace(Dt,"^")}function xn(t){return We(t).replace(Sn,"%3D")}function Rn(t){return qe(t).replace(It,"%23").replace(En,"%3F")}function On(t){return t==null?"":Rn(t).replace(_n,"%2F")}function Ce(t){try{return decodeURIComponent(""+t)}catch{}return""+t}const In=/\/$/,Tn=t=>t.replace(In,"");function Ye(t,e,n="/"){let o,s={},i="",r="";const f=e.indexOf("#");let a=e.indexOf("?");return f<a&&f>=0&&(a=-1),a>-1&&(o=e.slice(0,a),i=e.slice(a+1,f>-1?f:e.length),s=t(i)),f>-1&&(o=o||e.slice(0,f),r=e.slice(f,e.length)),o=Vn(o??e,n),{fullPath:o+(i&&"?")+i+r,path:o,query:s,hash:Ce(r)}}function Dn(t,e){const n=e.query?t(e.query):"";return e.path+(n&&"?")+n+(e.hash||"")}function rt(t,e){return!e||!t.toLowerCase().startsWith(e.toLowerCase())?t:t.slice(e.length)||"/"}function Pn(t,e,n){const o=e.matched.length-1,s=n.matched.length-1;return o>-1&&o===s&&de(e.matched[o],n.matched[s])&&Vt(e.params,n.params)&&t(e.query)===t(n.query)&&e.hash===n.hash}function de(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function Vt(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!Bn(t[n],e[n]))return!1;return!0}function Bn(t,e){return W(t)?at(t,e):W(e)?at(e,t):t===e}function at(t,e){return W(e)?t.length===e.length&&t.every((n,o)=>n===e[o]):t.length===1&&t[0]===e}function Vn(t,e){if(t.startsWith("/"))return t;if(!t)return e;const n=e.split("/"),o=t.split("/"),s=o[o.length-1];(s===".."||s===".")&&o.push("");let i=n.length-1,r,f;for(r=0;r<o.length;r++)if(f=o[r],f!==".")if(f==="..")i>1&&i--;else break;return n.slice(0,i).join("/")+"/"+o.slice(r).join("/")}const X={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var we;(function(t){t.pop="pop",t.push="push"})(we||(we={}));var ye;(function(t){t.back="back",t.forward="forward",t.unknown=""})(ye||(ye={}));function Mn(t){if(!t)if(ae){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),Tn(t)}const Ln=/^[^#]+#/;function kn(t,e){return t.replace(Ln,"#")+e}function Nn(t,e){const n=document.documentElement.getBoundingClientRect(),o=t.getBoundingClientRect();return{behavior:e.behavior,left:o.left-n.left-(e.left||0),top:o.top-n.top-(e.top||0)}}const Be=()=>({left:window.scrollX,top:window.scrollY});function Un(t){let e;if("el"in t){const n=t.el,o=typeof n=="string"&&n.startsWith("#"),s=typeof n=="string"?o?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!s)return;e=Nn(s,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function lt(t,e){return(history.state?history.state.position-e:-1)+t}const Ge=new Map;function Qn(t,e){Ge.set(t,e)}function Fn(t){const e=Ge.get(t);return Ge.delete(t),e}let Yn=()=>location.protocol+"//"+location.host;function Mt(t,e){const{pathname:n,search:o,hash:s}=e,i=t.indexOf("#");if(i>-1){let f=s.includes(t.slice(i))?t.slice(i).length:1,a=s.slice(f);return a[0]!=="/"&&(a="/"+a),rt(a,"")}return rt(n,t)+o+s}function jn(t,e,n,o){let s=[],i=[],r=null;const f=({state:l})=>{const p=Mt(t,location),S=n.value,A=e.value;let D=0;if(l){if(n.value=p,e.value=l,r&&r===S){r=null;return}D=A?l.position-A.position:0}else o(p);s.forEach(b=>{b(n.value,S,{delta:D,type:we.pop,direction:D?D>0?ye.forward:ye.back:ye.unknown})})};function a(){r=n.value}function d(l){s.push(l);const p=()=>{const S=s.indexOf(l);S>-1&&s.splice(S,1)};return i.push(p),p}function c(){const{history:l}=window;l.state&&l.replaceState(T({},l.state,{scroll:Be()}),"")}function u(){for(const l of i)l();i=[],window.removeEventListener("popstate",f),window.removeEventListener("beforeunload",c)}return window.addEventListener("popstate",f),window.addEventListener("beforeunload",c,{passive:!0}),{pauseListeners:a,listen:d,destroy:u}}function ct(t,e,n,o=!1,s=!1){return{back:t,current:e,forward:n,replaced:o,position:window.history.length,scroll:s?Be():null}}function Hn(t){const{history:e,location:n}=window,o={value:Mt(t,n)},s={value:e.state};s.value||i(o.value,{back:null,current:o.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(a,d,c){const u=t.indexOf("#"),l=u>-1?(n.host&&document.querySelector("base")?t:t.slice(u))+a:Yn()+t+a;try{e[c?"replaceState":"pushState"](d,"",l),s.value=d}catch(p){console.error(p),n[c?"replace":"assign"](l)}}function r(a,d){const c=T({},e.state,ct(s.value.back,a,s.value.forward,!0),d,{position:s.value.position});i(a,c,!0),o.value=a}function f(a,d){const c=T({},s.value,e.state,{forward:a,scroll:Be()});i(c.current,c,!0);const u=T({},ct(o.value,a,null),{position:c.position+1},d);i(a,u,!1),o.value=a}return{location:o,state:s,push:f,replace:r}}function Wn(t){t=Mn(t);const e=Hn(t),n=jn(t,e.state,e.location,e.replace);function o(i,r=!0){r||n.pauseListeners(),history.go(i)}const s=T({location:"",base:t,go:o,createHref:kn.bind(null,t)},e,n);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Gn(t){return typeof t=="string"||t&&typeof t=="object"}function Lt(t){return typeof t=="string"||typeof t=="symbol"}const kt=Symbol("");var ut;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(ut||(ut={}));function he(t,e){return T(new Error,{type:t,[kt]:!0},e)}function q(t,e){return t instanceof Error&&kt in t&&(e==null||!!(t.type&e))}const dt="[^/]+?",zn={sensitive:!1,strict:!1,start:!0,end:!0},Kn=/[.+*?^${}()[\]/\\]/g;function qn(t,e){const n=T({},zn,e),o=[];let s=n.start?"^":"";const i=[];for(const d of t){const c=d.length?[]:[90];n.strict&&!d.length&&(s+="/");for(let u=0;u<d.length;u++){const l=d[u];let p=40+(n.sensitive?.25:0);if(l.type===0)u||(s+="/"),s+=l.value.replace(Kn,"\\$&"),p+=40;else if(l.type===1){const{value:S,repeatable:A,optional:D,regexp:b}=l;i.push({name:S,repeatable:A,optional:D});const I=b||dt;if(I!==dt){p+=10;try{new RegExp(`(${I})`)}catch(j){throw new Error(`Invalid custom RegExp for param "${S}" (${I}): `+j.message)}}let P=A?`((?:${I})(?:/(?:${I}))*)`:`(${I})`;u||(P=D&&d.length<2?`(?:/${P})`:"/"+P),D&&(P+="?"),s+=P,p+=20,D&&(p+=-8),A&&(p+=-20),I===".*"&&(p+=-50)}c.push(p)}o.push(c)}if(n.strict&&n.end){const d=o.length-1;o[d][o[d].length-1]+=.7000000000000001}n.strict||(s+="/?"),n.end?s+="$":n.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const r=new RegExp(s,n.sensitive?"":"i");function f(d){const c=d.match(r),u={};if(!c)return null;for(let l=1;l<c.length;l++){const p=c[l]||"",S=i[l-1];u[S.name]=p&&S.repeatable?p.split("/"):p}return u}function a(d){let c="",u=!1;for(const l of t){(!u||!c.endsWith("/"))&&(c+="/"),u=!1;for(const p of l)if(p.type===0)c+=p.value;else if(p.type===1){const{value:S,repeatable:A,optional:D}=p,b=S in d?d[S]:"";if(W(b)&&!A)throw new Error(`Provided param "${S}" is an array but it is not repeatable (* or + modifiers)`);const I=W(b)?b.join("/"):b;if(!I)if(D)l.length<2&&(c.endsWith("/")?c=c.slice(0,-1):u=!0);else throw new Error(`Missing required param "${S}"`);c+=I}}return c||"/"}return{re:r,score:o,keys:i,parse:f,stringify:a}}function Jn(t,e){let n=0;for(;n<t.length&&n<e.length;){const o=e[n]-t[n];if(o)return o;n++}return t.length<e.length?t.length===1&&t[0]===40+40?-1:1:t.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function Nt(t,e){let n=0;const o=t.score,s=e.score;for(;n<o.length&&n<s.length;){const i=Jn(o[n],s[n]);if(i)return i;n++}if(Math.abs(s.length-o.length)===1){if(ht(o))return 1;if(ht(s))return-1}return s.length-o.length}function ht(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const Zn={type:0,value:""},Xn=/[a-zA-Z0-9_]/;function $n(t){if(!t)return[[]];if(t==="/")return[[Zn]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(p){throw new Error(`ERR (${n})/"${d}": ${p}`)}let n=0,o=n;const s=[];let i;function r(){i&&s.push(i),i=[]}let f=0,a,d="",c="";function u(){d&&(n===0?i.push({type:0,value:d}):n===1||n===2||n===3?(i.length>1&&(a==="*"||a==="+")&&e(`A repeatable param (${d}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:d,regexp:c,repeatable:a==="*"||a==="+",optional:a==="*"||a==="?"})):e("Invalid state to consume buffer"),d="")}function l(){d+=a}for(;f<t.length;){if(a=t[f++],a==="\\"&&n!==2){o=n,n=4;continue}switch(n){case 0:a==="/"?(d&&u(),r()):a===":"?(u(),n=1):l();break;case 4:l(),n=o;break;case 1:a==="("?n=2:Xn.test(a)?l():(u(),n=0,a!=="*"&&a!=="?"&&a!=="+"&&f--);break;case 2:a===")"?c[c.length-1]=="\\"?c=c.slice(0,-1)+a:n=3:c+=a;break;case 3:u(),n=0,a!=="*"&&a!=="?"&&a!=="+"&&f--,c="";break;default:e("Unknown state");break}}return n===2&&e(`Unfinished custom RegExp for param "${d}"`),u(),r(),s}function es(t,e,n){const o=qn($n(t.path),n),s=T(o,{record:t,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function ts(t,e){const n=[],o=new Map;e=gt({strict:!1,end:!0,sensitive:!1},e);function s(u){return o.get(u)}function i(u,l,p){const S=!p,A=pt(u);A.aliasOf=p&&p.record;const D=gt(e,u),b=[A];if("alias"in u){const j=typeof u.alias=="string"?[u.alias]:u.alias;for(const te of j)b.push(pt(T({},A,{components:p?p.record.components:A.components,path:te,aliasOf:p?p.record:A})))}let I,P;for(const j of b){const{path:te}=j;if(l&&te[0]!=="/"){const Z=l.record.path,Q=Z[Z.length-1]==="/"?"":"/";j.path=l.record.path+(te&&Q+te)}if(I=es(j,l,D),p?p.alias.push(I):(P=P||I,P!==I&&P.alias.push(I),S&&u.name&&!mt(I)&&r(u.name)),Ut(I)&&a(I),A.children){const Z=A.children;for(let Q=0;Q<Z.length;Q++)i(Z[Q],I,p&&p.children[Q])}p=p||I}return P?()=>{r(P)}:ve}function r(u){if(Lt(u)){const l=o.get(u);l&&(o.delete(u),n.splice(n.indexOf(l),1),l.children.forEach(r),l.alias.forEach(r))}else{const l=n.indexOf(u);l>-1&&(n.splice(l,1),u.record.name&&o.delete(u.record.name),u.children.forEach(r),u.alias.forEach(r))}}function f(){return n}function a(u){const l=os(u,n);n.splice(l,0,u),u.record.name&&!mt(u)&&o.set(u.record.name,u)}function d(u,l){let p,S={},A,D;if("name"in u&&u.name){if(p=o.get(u.name),!p)throw he(1,{location:u});D=p.record.name,S=T(ft(l.params,p.keys.filter(P=>!P.optional).concat(p.parent?p.parent.keys.filter(P=>P.optional):[]).map(P=>P.name)),u.params&&ft(u.params,p.keys.map(P=>P.name))),A=p.stringify(S)}else if(u.path!=null)A=u.path,p=n.find(P=>P.re.test(A)),p&&(S=p.parse(A),D=p.record.name);else{if(p=l.name?o.get(l.name):n.find(P=>P.re.test(l.path)),!p)throw he(1,{location:u,currentLocation:l});D=p.record.name,S=T({},l.params,u.params),A=p.stringify(S)}const b=[];let I=p;for(;I;)b.unshift(I.record),I=I.parent;return{name:D,path:A,params:S,matched:b,meta:ss(b)}}t.forEach(u=>i(u));function c(){n.length=0,o.clear()}return{addRoute:i,resolve:d,removeRoute:r,clearRoutes:c,getRoutes:f,getRecordMatcher:s}}function ft(t,e){const n={};for(const o of e)o in t&&(n[o]=t[o]);return n}function pt(t){const e={path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:t.aliasOf,beforeEnter:t.beforeEnter,props:ns(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function ns(t){const e={},n=t.props||!1;if("component"in t)e.default=n;else for(const o in t.components)e[o]=typeof n=="object"?n[o]:n;return e}function mt(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function ss(t){return t.reduce((e,n)=>T(e,n.meta),{})}function gt(t,e){const n={};for(const o in t)n[o]=o in e?e[o]:t[o];return n}function os(t,e){let n=0,o=e.length;for(;n!==o;){const i=n+o>>1;Nt(t,e[i])<0?o=i:n=i+1}const s=is(t);return s&&(o=e.lastIndexOf(s,o-1)),o}function is(t){let e=t;for(;e=e.parent;)if(Ut(e)&&Nt(t,e)===0)return e}function Ut({record:t}){return!!(t.name||t.components&&Object.keys(t.components).length||t.redirect)}function rs(t){const e={};if(t===""||t==="?")return e;const o=(t[0]==="?"?t.slice(1):t).split("&");for(let s=0;s<o.length;++s){const i=o[s].replace(Tt," "),r=i.indexOf("="),f=Ce(r<0?i:i.slice(0,r)),a=r<0?null:Ce(i.slice(r+1));if(f in e){let d=e[f];W(d)||(d=e[f]=[d]),d.push(a)}else e[f]=a}return e}function _t(t){let e="";for(let n in t){const o=t[n];if(n=xn(n),o==null){o!==void 0&&(e+=(e.length?"&":"")+n);continue}(W(o)?o.map(i=>i&&We(i)):[o&&We(o)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+n,i!=null&&(e+="="+i))})}return e}function as(t){const e={};for(const n in t){const o=t[n];o!==void 0&&(e[n]=W(o)?o.map(s=>s==null?null:""+s):o==null?o:""+o)}return e}const ls=Symbol(""),St=Symbol(""),Je=Symbol(""),Qt=Symbol(""),ze=Symbol("");function me(){let t=[];function e(o){return t.push(o),()=>{const s=t.indexOf(o);s>-1&&t.splice(s,1)}}function n(){t=[]}return{add:e,list:()=>t.slice(),reset:n}}function $(t,e,n,o,s,i=r=>r()){const r=o&&(o.enterCallbacks[s]=o.enterCallbacks[s]||[]);return()=>new Promise((f,a)=>{const d=l=>{l===!1?a(he(4,{from:n,to:e})):l instanceof Error?a(l):Gn(l)?a(he(2,{from:e,to:l})):(r&&o.enterCallbacks[s]===r&&typeof l=="function"&&r.push(l),f())},c=i(()=>t.call(o&&o.instances[s],e,n,d));let u=Promise.resolve(c);t.length<3&&(u=u.then(d)),u.catch(l=>a(l))})}function je(t,e,n,o,s=i=>i()){const i=[];for(const r of t)for(const f in r.components){let a=r.components[f];if(!(e!=="beforeRouteEnter"&&!r.instances[f]))if(Ot(a)){const c=(a.__vccOpts||a)[e];c&&i.push($(c,n,o,r,f,s))}else{let d=a();i.push(()=>d.then(c=>{if(!c)throw new Error(`Couldn't resolve component "${f}" at "${r.path}"`);const u=mn(c)?c.default:c;r.mods[f]=c,r.components[f]=u;const p=(u.__vccOpts||u)[e];return p&&$(p,n,o,r,f,s)()}))}}return i}function Et(t){const e=Ae(Je),n=Ae(Qt),o=z(()=>{const a=Ee(t.to);return e.resolve(a)}),s=z(()=>{const{matched:a}=o.value,{length:d}=a,c=a[d-1],u=n.matched;if(!c||!u.length)return-1;const l=u.findIndex(de.bind(null,c));if(l>-1)return l;const p=vt(a[d-2]);return d>1&&vt(c)===p&&u[u.length-1].path!==p?u.findIndex(de.bind(null,a[d-2])):l}),i=z(()=>s.value>-1&&fs(n.params,o.value.params)),r=z(()=>s.value>-1&&s.value===n.matched.length-1&&Vt(n.params,o.value.params));function f(a={}){if(hs(a)){const d=e[Ee(t.replace)?"replace":"push"](Ee(t.to)).catch(ve);return t.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>d),d}return Promise.resolve()}return{route:o,href:z(()=>o.value.href),isActive:i,isExactActive:r,navigate:f}}function cs(t){return t.length===1?t[0]:t}const us=xt({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Et,setup(t,{slots:e}){const n=nn(Et(t)),{options:o}=Ae(Je),s=z(()=>({[yt(t.activeClass,o.linkActiveClass,"router-link-active")]:n.isActive,[yt(t.exactActiveClass,o.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive}));return()=>{const i=e.default&&cs(e.default(n));return t.custom?i:Rt("a",{"aria-current":n.isExactActive?t.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:s.value},i)}}}),ds=us;function hs(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function fs(t,e){for(const n in e){const o=e[n],s=t[n];if(typeof o=="string"){if(o!==s)return!1}else if(!W(s)||s.length!==o.length||o.some((i,r)=>i!==s[r]))return!1}return!0}function vt(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const yt=(t,e,n)=>t??e??n,ps=xt({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:n}){const o=Ae(ze),s=z(()=>t.route||o.value),i=Ae(St,0),r=z(()=>{let d=Ee(i);const{matched:c}=s.value;let u;for(;(u=c[d])&&!u.components;)d++;return d}),f=z(()=>s.value.matched[r.value]);Qe(St,z(()=>r.value+1)),Qe(ls,f),Qe(ze,s);const a=sn();return on(()=>[a.value,f.value,t.name],([d,c,u],[l,p,S])=>{c&&(c.instances[u]=d,p&&p!==c&&d&&d===l&&(c.leaveGuards.size||(c.leaveGuards=p.leaveGuards),c.updateGuards.size||(c.updateGuards=p.updateGuards))),d&&c&&(!p||!de(c,p)||!l)&&(c.enterCallbacks[u]||[]).forEach(A=>A(d))},{flush:"post"}),()=>{const d=s.value,c=t.name,u=f.value,l=u&&u.components[c];if(!l)return At(n.default,{Component:l,route:d});const p=u.props[c],S=p?p===!0?d.params:typeof p=="function"?p(d):p:null,D=Rt(l,T({},S,e,{onVnodeUnmounted:b=>{b.component.isUnmounted&&(u.instances[c]=null)},ref:a}));return At(n.default,{Component:D,route:d})||D}}});function At(t,e){if(!t)return null;const n=t(e);return n.length===1?n[0]:n}const ms=ps;function gs(t){const e=ts(t.routes,t),n=t.parseQuery||rs,o=t.stringifyQuery||_t,s=t.history,i=me(),r=me(),f=me(),a=$t(X);let d=X;ae&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const c=Fe.bind(null,h=>""+h),u=Fe.bind(null,On),l=Fe.bind(null,Ce);function p(h,_){let g,E;return Lt(h)?(g=e.getRecordMatcher(h),E=_):E=h,e.addRoute(E,g)}function S(h){const _=e.getRecordMatcher(h);_&&e.removeRoute(_)}function A(){return e.getRoutes().map(h=>h.record)}function D(h){return!!e.getRecordMatcher(h)}function b(h,_){if(_=T({},_||a.value),typeof h=="string"){const w=Ye(n,h,_.path),M=e.resolve({path:w.path},_),pe=s.createHref(w.fullPath);return T(w,M,{params:l(M.params),hash:Ce(w.hash),redirectedFrom:void 0,href:pe})}let g;if(h.path!=null)g=T({},h,{path:Ye(n,h.path,_.path).path});else{const w=T({},h.params);for(const M in w)w[M]==null&&delete w[M];g=T({},h,{params:u(w)}),_.params=u(_.params)}const E=e.resolve(g,_),B=h.hash||"";E.params=c(l(E.params));const V=Dn(o,T({},h,{hash:bn(B),path:E.path})),x=s.createHref(V);return T({fullPath:V,hash:B,query:o===_t?as(h.query):h.query||{}},E,{redirectedFrom:void 0,href:x})}function I(h){return typeof h=="string"?Ye(n,h,a.value.path):T({},h)}function P(h,_){if(d!==h)return he(8,{from:_,to:h})}function j(h){return Q(h)}function te(h){return j(T(I(h),{replace:!0}))}function Z(h){const _=h.matched[h.matched.length-1];if(_&&_.redirect){const{redirect:g}=_;let E=typeof g=="function"?g(h):g;return typeof E=="string"&&(E=E.includes("?")||E.includes("#")?E=I(E):{path:E},E.params={}),T({query:h.query,hash:h.hash,params:E.path!=null?{}:h.params},E)}}function Q(h,_){const g=d=b(h),E=a.value,B=h.state,V=h.force,x=h.replace===!0,w=Z(g);if(w)return Q(T(I(w),{state:typeof w=="object"?T({},B,w.state):B,force:V,replace:x}),_||g);const M=g;M.redirectedFrom=_;let pe;return!V&&Pn(o,E,g)&&(pe=he(16,{to:M,from:E}),ot(E,E,!0,!1)),(pe?Promise.resolve(pe):et(M,E)).catch(U=>q(U)?q(U,2)?U:ke(U):Le(U,M,E)).then(U=>{if(U){if(q(U,2))return Q(T({replace:x},I(U.to),{state:typeof U.to=="object"?T({},B,U.to.state):B,force:V}),_||M)}else U=nt(M,E,!0,x,B);return tt(M,E,U),U})}function Kt(h,_){const g=P(h,_);return g?Promise.reject(g):Promise.resolve()}function Ve(h){const _=Re.values().next().value;return _&&typeof _.runWithContext=="function"?_.runWithContext(h):h()}function et(h,_){let g;const[E,B,V]=_s(h,_);g=je(E.reverse(),"beforeRouteLeave",h,_);for(const w of E)w.leaveGuards.forEach(M=>{g.push($(M,h,_))});const x=Kt.bind(null,h,_);return g.push(x),re(g).then(()=>{g=[];for(const w of i.list())g.push($(w,h,_));return g.push(x),re(g)}).then(()=>{g=je(B,"beforeRouteUpdate",h,_);for(const w of B)w.updateGuards.forEach(M=>{g.push($(M,h,_))});return g.push(x),re(g)}).then(()=>{g=[];for(const w of V)if(w.beforeEnter)if(W(w.beforeEnter))for(const M of w.beforeEnter)g.push($(M,h,_));else g.push($(w.beforeEnter,h,_));return g.push(x),re(g)}).then(()=>(h.matched.forEach(w=>w.enterCallbacks={}),g=je(V,"beforeRouteEnter",h,_,Ve),g.push(x),re(g))).then(()=>{g=[];for(const w of r.list())g.push($(w,h,_));return g.push(x),re(g)}).catch(w=>q(w,8)?w:Promise.reject(w))}function tt(h,_,g){f.list().forEach(E=>Ve(()=>E(h,_,g)))}function nt(h,_,g,E,B){const V=P(h,_);if(V)return V;const x=_===X,w=ae?history.state:{};g&&(E||x?s.replace(h.fullPath,T({scroll:x&&w&&w.scroll},B)):s.push(h.fullPath,B)),a.value=h,ot(h,_,g,x),ke()}let fe;function qt(){fe||(fe=s.listen((h,_,g)=>{if(!it.listening)return;const E=b(h),B=Z(E);if(B){Q(T(B,{replace:!0,force:!0}),E).catch(ve);return}d=E;const V=a.value;ae&&Qn(lt(V.fullPath,g.delta),Be()),et(E,V).catch(x=>q(x,12)?x:q(x,2)?(Q(T(I(x.to),{force:!0}),E).then(w=>{q(w,20)&&!g.delta&&g.type===we.pop&&s.go(-1,!1)}).catch(ve),Promise.reject()):(g.delta&&s.go(-g.delta,!1),Le(x,E,V))).then(x=>{x=x||nt(E,V,!1),x&&(g.delta&&!q(x,8)?s.go(-g.delta,!1):g.type===we.pop&&q(x,20)&&s.go(-1,!1)),tt(E,V,x)}).catch(ve)}))}let Me=me(),st=me(),xe;function Le(h,_,g){ke(h);const E=st.list();return E.length?E.forEach(B=>B(h,_,g)):console.error(h),Promise.reject(h)}function Jt(){return xe&&a.value!==X?Promise.resolve():new Promise((h,_)=>{Me.add([h,_])})}function ke(h){return xe||(xe=!h,qt(),Me.list().forEach(([_,g])=>h?g(h):_()),Me.reset()),h}function ot(h,_,g,E){const{scrollBehavior:B}=t;if(!ae||!B)return Promise.resolve();const V=!g&&Fn(lt(h.fullPath,0))||(E||!g)&&history.state&&history.state.scroll||null;return tn().then(()=>B(h,_,V)).then(x=>x&&Un(x)).catch(x=>Le(x,h,_))}const Ne=h=>s.go(h);let Ue;const Re=new Set,it={currentRoute:a,listening:!0,addRoute:p,removeRoute:S,clearRoutes:e.clearRoutes,hasRoute:D,getRoutes:A,resolve:b,options:t,push:j,replace:te,go:Ne,back:()=>Ne(-1),forward:()=>Ne(1),beforeEach:i.add,beforeResolve:r.add,afterEach:f.add,onError:st.add,isReady:Jt,install(h){const _=this;h.component("RouterLink",ds),h.component("RouterView",ms),h.config.globalProperties.$router=_,Object.defineProperty(h.config.globalProperties,"$route",{enumerable:!0,get:()=>Ee(a)}),ae&&!Ue&&a.value===X&&(Ue=!0,j(s.location).catch(B=>{}));const g={};for(const B in X)Object.defineProperty(g,B,{get:()=>a.value[B],enumerable:!0});h.provide(Je,_),h.provide(Qt,en(g)),h.provide(ze,a);const E=h.unmount;Re.add(h),h.unmount=function(){Re.delete(h),Re.size<1&&(d=X,fe&&fe(),fe=null,a.value=X,Ue=!1,xe=!1),E()}}};function re(h){return h.reduce((_,g)=>_.then(()=>Ve(g)),Promise.resolve())}return it}function _s(t,e){const n=[],o=[],s=[],i=Math.max(e.matched.length,t.matched.length);for(let r=0;r<i;r++){const f=e.matched[r];f&&(t.matched.find(d=>de(d,f))?o.push(f):n.push(f));const a=t.matched[r];a&&(e.matched.find(d=>de(d,a))||s.push(a))}return[n,o,s]}const Ss={},Es={class:"loading"};function vs(t,e){return C(),R("div",Es,e[0]||(e[0]=[rn('<div class="loading__dot" data-v-4210e471></div><div class="loading__dot" style="animation-delay:0.2s;" data-v-4210e471></div><div class="loading__dot" style="animation-delay:0.4s;" data-v-4210e471></div><div class="loading__dot" style="animation-delay:0.6s;" data-v-4210e471></div><div class="loading__dot" style="animation-delay:0.8s;" data-v-4210e471></div><p class="mt10" data-v-4210e471>连接中，请稍后...</p>',6)]))}const ys=Y(Ss,[["render",vs],["__scopeId","data-v-4210e471"]]),As="/assets/play-bf3fc488.png",Cs="/assets/pause-6080c100.png",ws="/assets/stop-b52c390d.png",bs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAG/0lEQVR4nO3dz1EcRxTH8aWg4Eoa/CuTAVYIysAZ2I5AOALFoEi6lcFWQcHVIejMYdvd+I0KSfDY2Z1+3W/m+6midlcHVtO//p45WAF4E4EACgIBFAQCKAgEUBAIoCAQQEEggIJAAAWBAAoCARQEAigIxNDl5eXvm83mJr/d2/Hx8Zf1ev3vClURiKHz8/PblNKn/HZvh4eHH+7v7+MKVRGIIQLxh0AMEYg/BGKIQPwhEEME4g+BGCIQfwjEEIH4QyCGCMQfAjFEIP4QiCEC8YdADBGIPwRiiED8IRBDBOIPgRgiEH8IxBCB+EMghgjEHwIxRCD+EIghAvGHQAwRiD8EYohA/CEQQwTiD4EYIhB/CMQQgfhDIIYIxB8CMUQg/hCIIQLxh0AMEYg/BGKIQPwhEEME4g+BGCIQfwjEEIH4QyCGCMQfAjFEIP4QiCEC8YdADBGIPwRiiED8IRBDBOIPgRgiEH8IxBCB+EMghgjEHwIxRCD+EIghAvGHQAwRiD8EYohA/CEQQwTiD4EYIhB/CMQQgfhDIIYIxB8CMUQg/hCIIQLxh0AMEYg/BGKIQPwhEEME4g+BGCIQfwjEEIH4QyCGCMQfAjFEIP4QiCEC8YdADBGIP7MK5OLi4nqz2Xw+OTn5uF6vv+V/6soSArm+vj59enr6fHx8/HePG4w1m0BKHPnyhZTS6cHBwToP9KG3geYeiMQRUkrXvW4w1iwCeRlH/visx4HmHMjLOPLHZz1uMJb7QF6LY9DbQHMN5LU4Br1tMJbrQLQ4Bj0NNMdAtDgGPW0wlttAtolj0MtAcwtkmzgGvWwwlstAxsQx6GGgOQUyJo5BDxuM5S6QXeIYtB5oLoHsEseg9QZjuQpknzgGLQeaQyD7xDFoucFYbgKZIo5Bq4G8BzJFHINWG4zlIpAp4xi0GMhzIFPGMWixwVjdB1IjjoH1QF4DqRHHwHqDsboOpGYcA8uBPAZSM46B5QZjdR3I2dlZXK1WN/mnKquBvAViEccgb/DPw8PD7aozXQciA8U80G/5Y1V5oOqReApEzj4kgziyL4+Pj3+sOtR1IIUMFfNQ7iPxEoiceUgLj6PoPpBCBot5MNeReAhEzjok4njmIpBChot5OLeR9B6InHFIxPGdm0AKGTDmAV1G0nMgcrYhEccPXAVSyJAxD+kukl4DkTMNiTh+4S6QQgaNeVBXkfQYiJxlSMTxKpeBFDJszMO6iaS3QOQMQyKON7kNpJCBYx7YRSQ9BSJnFxJxqFwHUsjQMQ/dfSS9BCJnFhJxvMt9IIUMHvPgXUfSQyByViERx1ZmEUghw8c8fLeRtA5Ezigk4tjabAIp5ALEfAG6jKRlIHI2IRHHKLMKpJCLEPNF6C6SVoHImYREHKPNLpBCLkTMF6KrSFoEImcREnHsZJaBFHIxYr4Y3URiHYicQUjEsbPZBlLIBYn5gnQRiWUg8uwhEcdeZh1IIRcl5ovSPBKrQOSZQyKOvc0+kEIuTMwXpmkkFoHIs4ZEHJNYRCCFXJyYL06zSGoHIs8YEnFMZjGBFHKBYr5ATSKpGYg8W0jEMalFBVLIRYr5IplHUisQeaaQiGNyiwukkAsV84UyjaRGIPIsIRFHFYsMpJCLFfPFMoskf99f+fsmC+To6Gidf2dIxFHNYgMprCPJP183m82f+eMUPubf9ykRR1WLDqSwjGRKOY5v+f98mt/Wttg4isUHUniNxMCi4ygIRBDJLxYfR0EgLxDJd8QhCOQnREIcLxHIKxYcCXH8hEDesMBIiOMVBKJYUCTE8QYCeccCIiEOBYFsYcaREMc7CGRLM4yEOLZAICPMKBLi2BKBjDSDSIhjBALZgeNIiGMkAtmRw0iIYwcEsgdHkRDHjghkTw4iIY49EMgEOo6EOPZEIBPpMBLimACBTKijSIhjIgQysQ4iIY4JEUgFDSMhjokRSCUNIiGOCgikIsNIiKMSAqnMIBLiqIhADFSMhDgqIxAjFSIhDgMEYmjCSIjDCIEYmyAS4jBEIA3sEQlxGCOQRnaIhDgaIJCGRkRCHI0QSGNbREIcDRFIB5RIiKMxAunEK5EQRwcIpCMvIlkTRx8IpDMlkvX6/7+rjvYIBFAQCKAgEEBBIICCQAAFgQAKAgEUBAIoCARQEAigIBBAQSCAgkAABYEACgIBFAQCKAgEUBAIoCAQQEEggMIkkKurq5v8Akzq7u7ua36p6iD/VHd2dpbyCzCpx8fH6ve3+hcUBIIaCARQEAigIBBAQSCAgkAABYEACgIBFAQCKAgEUBAIoCAQQEEggIJAAAWBAAoCARQEAihmE8j5+fntCpjYw8PD7aoyk0AArwgEUBAIoCAQQEEggIJAAAWBAAoCARQEAigIBFAQCKAgEEDxH6l5bkGJTaU/AAAAAElFTkSuQmCC";let xs=class{constructor(){this.listeners={}}on(e,n,o){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(n),o==null?void 0:o.once){const s=()=>{this.un(e,s),this.un(e,n)};return this.on(e,s),s}return()=>this.un(e,n)}un(e,n){var o;(o=this.listeners[e])===null||o===void 0||o.delete(n)}once(e,n){return this.on(e,n,{once:!0})}unAll(){this.listeners={}}emit(e,...n){this.listeners[e]&&this.listeners[e].forEach(o=>o(...n))}},Rs=class extends xs{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}_init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}};function Ft(t,e){const n=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[o,s]of Object.entries(e))if(o==="children")for(const[i,r]of Object.entries(e))typeof r=="string"?n.appendChild(document.createTextNode(r)):n.appendChild(Ft(i,r));else o==="style"?Object.assign(n.style,s):o==="textContent"?n.textContent=s:n.setAttribute(o,s.toString());return n}function Ct(t,e,n){const o=Ft(t,e||{});return n==null||n.appendChild(o),o}const Os={lineWidth:1,labelSize:11,formatTimeCallback:t=>`${Math.floor(t/60)}:${`0${Math.floor(t)%60}`.slice(-2)}`};class Ze extends Rs{constructor(e){super(e||{}),this.unsubscribe=()=>{},this.onPointerMove=n=>{if(!this.wavesurfer)return;const o=this.wavesurfer.getWrapper().getBoundingClientRect(),{width:s}=o,i=n.clientX-o.left,r=Math.min(1,Math.max(0,i/s)),f=Math.min(s-this.options.lineWidth-1,i);this.wrapper.style.transform=`translateX(${f}px)`,this.wrapper.style.opacity="1";const a=this.wavesurfer.getDuration()||0;this.label.textContent=this.options.formatTimeCallback(a*r);const d=this.label.offsetWidth;this.label.style.transform=f+d>s?`translateX(-${d+this.options.lineWidth}px)`:"",this.emit("hover",r)},this.onPointerLeave=()=>{this.wrapper.style.opacity="0"},this.options=Object.assign({},Os,e),this.wrapper=Ct("div",{part:"hover"}),this.label=Ct("span",{part:"hover-label"},this.wrapper)}static create(e){return new Ze(e)}addUnits(e){return`${e}${typeof e=="number"?"px":""}`}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const e=this.wavesurfer.options,n=this.options.lineColor||e.cursorColor||e.progressColor;Object.assign(this.wrapper.style,{position:"absolute",zIndex:10,left:0,top:0,height:"100%",pointerEvents:"none",borderLeft:`${this.addUnits(this.options.lineWidth)} solid ${n}`,opacity:"0",transition:"opacity .1s ease-in"}),Object.assign(this.label.style,{display:"block",backgroundColor:this.options.labelBackground,color:this.options.labelColor,fontSize:`${this.addUnits(this.options.labelSize)}`,transition:"transform .1s ease-in",padding:"2px 3px"});const o=this.wavesurfer.getWrapper();o.appendChild(this.wrapper),o.addEventListener("pointermove",this.onPointerMove),o.addEventListener("pointerleave",this.onPointerLeave),o.addEventListener("wheel",this.onPointerMove),this.unsubscribe=()=>{o.removeEventListener("pointermove",this.onPointerMove),o.removeEventListener("pointerleave",this.onPointerLeave),o.removeEventListener("wheel",this.onPointerLeave)}}destroy(){super.destroy(),this.unsubscribe(),this.wrapper.remove()}}class Is{constructor(){this.listeners={}}on(e,n,o){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(n),o==null?void 0:o.once){const s=()=>{this.un(e,s),this.un(e,n)};return this.on(e,s),s}return()=>this.un(e,n)}un(e,n){var o;(o=this.listeners[e])===null||o===void 0||o.delete(n)}once(e,n){return this.on(e,n,{once:!0})}unAll(){this.listeners={}}emit(e,...n){this.listeners[e]&&this.listeners[e].forEach(o=>o(...n))}}class Ts extends Is{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}_init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}}const Ds={scale:.5,deltaThreshold:5,exponentialZooming:!1,iterations:20};class Xe extends Ts{constructor(e){super(e||{}),this.wrapper=void 0,this.container=null,this.accumulatedDelta=0,this.pointerTime=0,this.oldX=0,this.endZoom=0,this.startZoom=0,this.onWheel=n=>{if(this.wavesurfer&&this.container&&!(Math.abs(n.deltaX)>=Math.abs(n.deltaY))&&(n.preventDefault(),this.accumulatedDelta+=-n.deltaY,this.startZoom===0&&this.options.exponentialZooming&&(this.startZoom=this.wavesurfer.getWrapper().clientWidth/this.wavesurfer.getDuration()),this.options.deltaThreshold===0||Math.abs(this.accumulatedDelta)>=this.options.deltaThreshold)){const o=this.wavesurfer.getDuration(),s=this.wavesurfer.options.minPxPerSec===0?this.wavesurfer.getWrapper().scrollWidth/o:this.wavesurfer.options.minPxPerSec,i=n.clientX-this.container.getBoundingClientRect().left,r=this.container.clientWidth,f=this.wavesurfer.getScroll();i===this.oldX&&this.oldX!==0||(this.pointerTime=(f+i)/s),this.oldX=i;const a=this.calculateNewZoom(s,this.accumulatedDelta),d=r/a*(i/r);a*o<r?(this.wavesurfer.zoom(r/o),this.container.scrollLeft=0):(this.wavesurfer.zoom(a),this.container.scrollLeft=(this.pointerTime-d)*a),this.accumulatedDelta=0}},this.calculateNewZoom=(n,o)=>{let s;if(this.options.exponentialZooming){const i=o>0?Math.pow(this.endZoom/this.startZoom,1/(this.options.iterations-1)):Math.pow(this.startZoom/this.endZoom,1/(this.options.iterations-1));s=Math.max(0,n*i)}else s=Math.max(0,n+o*this.options.scale);return Math.min(s,this.options.maxZoom)},this.options=Object.assign({},Ds,e)}static create(e){return new Xe(e)}onInit(){var e;this.wrapper=(e=this.wavesurfer)===null||e===void 0?void 0:e.getWrapper(),this.wrapper&&(this.container=this.wrapper.parentElement,this.container.addEventListener("wheel",this.onWheel),this.options.maxZoom===void 0&&(this.options.maxZoom=this.container.clientWidth),this.endZoom=this.options.maxZoom)}destroy(){this.wrapper&&this.wrapper.removeEventListener("wheel",this.onWheel),super.destroy()}}const Te=t=>new Promise(e=>{setTimeout(()=>{e()},t)}),Ps=(t="",e="未知文件",n)=>{const o=document.createElement("a");o.style.display="none",o.setAttribute("target","_blank"),e&&o.setAttribute("download",e),o.href=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),n&&n()};const Bs={name:"AudioBox",props:{uniqueIndex:{type:[String,Number],default:""},audioUrl:{type:String,default:""},audioType:{type:String,default:"input"},options:{type:Object,default:()=>({})},width:{type:String,default:""},height:{type:String,default:""},zoomable:{type:Boolean,default:!0}},data(){return{playIcon:As,pauseIcon:Cs,stopIcon:ws,downloadIcon:bs,waveSurfer:null,playState:!1,readyState:!1,defaultOptions:{height:this.height,width:this.width,splitChannels:!1,normalize:!1,cursorColor:"#ddd5e9",cursorWidth:1,barWidth:1,barGap:1,barRadius:1,barHeight:1,barAlign:"",minPxPerSec:100,fillParent:!0,url:this.audioUrl,mediaControls:!1,autoplay:!1,interact:!0,dragToSeek:!1,hideScrollbar:!0,audioRate:1,autoScroll:!0,autoCenter:!0,sampleRate:8e3}}},mounted(){this.initWaveSurfer()},watch:{audioUrl(t){t&&this.waveSurfer.setOptions({url:t})}},methods:{waveGradient(){const t=document.createElement("canvas"),e=t.getContext("2d"),n=e.createLinearGradient(0,0,0,t.height*1.2);n.addColorStop(0,"#8EA7FF"),n.addColorStop(t.height*.7/t.height,"#131212"),n.addColorStop((t.height*.7+1)/t.height,"#ffffff"),n.addColorStop((t.height*.7+2)/t.height,"#ffffff"),n.addColorStop((t.height*.7+3)/t.height,"#B1B1B1"),n.addColorStop(1,"#B1B1B1");const o=e.createLinearGradient(0,0,0,t.height*1.2);return o.addColorStop(0,"#E33FE6"),o.addColorStop(t.height*.7/t.height,"#134cff"),o.addColorStop((t.height*.7+1)/t.height,"#ffffff"),o.addColorStop((t.height*.7+2)/t.height,"#ffffff"),o.addColorStop((t.height*.7+3)/t.height,"#007aff"),o.addColorStop(1,"#007aff"),{gradient:n,progressGradient:o}},formatTime(t){const e=Math.floor(t/60),o=`0${Math.round(t)%60}`.slice(-2);return`${e}:${o}`},hoverFn(t){const{audioRef:e={},hoverRef:n={}}=this.$refs;n.style.width=`${t.offsetX}px`},initWaveSurfer(){this.$nextTick(()=>{const{audioRef:t={},timeRef:e={},durationRef:n={}}=this.$refs,{gradient:o,progressGradient:s}=this.waveGradient(),i={container:t,...this.defaultOptions,waveColor:o,progressColor:s,plugins:[Ze.create({lineColor:"#134cff",lineWidth:2,labelBackground:"#000000bf",labelColor:"#fff",labelSize:"11px"})],...this.options};this.waveSurfer=dn.create(i),this.zoomable&&this.waveSurfer.registerPlugin(Xe.create({scale:.5,maxZoom:100})),t.addEventListener("pointermove",this.hoverFn),this.waveSurfer.on("load",r=>{this.$emit("load",r)}),this.waveSurfer.on("ready",r=>{this.readyState=!0,this.$emit("ready",r)}),this.waveSurfer.on("play",()=>{this.playState=!0,this.$emit("play")}),this.waveSurfer.on("pause",()=>{this.playState=!1,this.$emit("pause")}),this.waveSurfer.on("finish",()=>{this.playState=!1,this.$emit("finish")}),this.waveSurfer.on("interaction",()=>{this.waveSurfer.playPause()}),this.waveSurfer.on("decode",r=>{n.textContent=this.formatTime(r)}),this.waveSurfer.on("timeupdate",r=>{e.textContent=this.formatTime(r),this.$emit("timeupdate",r)}),this.waveSurfer.on("audioprocess",r=>{this.$emit("audioprocess",r)}),this.waveSurfer.on("error",()=>{this.$emit("error")})})},getWaveSUrfer(){return this.waveSurfer},playPause(){this.waveSurfer.playPause()},endedPlay(){this.waveSurfer.stop()},downloadAudio(){Ps(this.audioUrl,"audio.wav")}},beforeDestroy(){const{audioRef:t={}}=this.$refs;t.removeEventListener("pointermove",this.hoverFn),this.waveSurfer&&this.waveSurfer.destroy()}},Vs={class:"audio-box__wave"},Ms={class:"audio-box__wave-inner"},Ls={class:"audio-box__wave-box",ref:"audioRef"},ks={class:"audio-box__wave-hover",ref:"hoverRef"},Ns={class:"audio-box__wave-btns flex flex-x-between flex-y-center"},Us={class:"flex gap-8"},Qs={class:"fs14 lh16"},Fs={class:"audio-box__wave-time",ref:"timeRef"},Ys={class:"audio-box__wave-duration",ref:"durationRef"};function js(t,e,n,o,s,i){return C(),R("div",{class:K(["audio-box",{output:n.audioType==="output"}])},[m("div",Vs,[m("div",Ms,[m("div",Ls,null,512),_e(m("div",ks,null,512),[[Se,s.readyState]])]),_e(m("div",Ns,[m("div",Us,[m("i",{class:K(["iconfont pointer",s.playState?"icon-pause":"icon-play"]),onClick:e[0]||(e[0]=(...r)=>i.playPause&&i.playPause(...r))},null,2),m("i",{class:"icon-stop iconfont pointer",onClick:e[1]||(e[1]=(...r)=>i.endedPlay&&i.endedPlay(...r))}),m("i",{class:"icon-download iconfont pointer",onClick:e[2]||(e[2]=(...r)=>i.downloadAudio&&i.downloadAudio(...r))})]),m("div",Qs,[_e(m("label",Fs,"0:00",512),[[Se,s.readyState]]),e[3]||(e[3]=k("/")),_e(m("label",Ys,"0:00",512),[[Se,s.readyState]])])],512),[[Se,s.readyState]])])],2)}const Yt=Y(Bs,[["render",js],["__scopeId","data-v-c30aef63"]]);function jt(t){var e;return(e=navigator==null?void 0:navigator.mediaDevices)!=null&&e.getUserMedia?navigator.mediaDevices.getUserMedia(t):navigator.getUserMedia?navigator.getUserMedia(t):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(t):navigator.mozGetUserMedia?navigator.mozGetUserMedia(t):navigator.msGetUserMedia?navigator.msGetUserMedia(t):Promise.reject(new Error("当前浏览器不支持getUserMedia！"))}function Hs(t){return navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(t):navigator.getDisplayMedia?navigator.getDisplayMedia(t):navigator.webkitGetDisplayMedia?navigator.webkitGetDisplayMedia(t):navigator.mozGetDisplayMedia?navigator.mozGetDisplayMedia(t):navigator.msGetDisplayMedia?navigator.msGetDisplayMedia(t):Promise.reject(new Error("当前浏览器不支持getDisplayMedia！"))}function Ws(t){const e=window.atob(t),n=e.length,o=new Uint8Array(n);for(let s=0;s<n;s++)o[s]=e.charCodeAt(s);return o.buffer}function Gs(t,e){const n=atob(t),o=new ArrayBuffer(n.length),s=new Uint8Array(o);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return new Blob([o],{type:e})}function wt(t,e=!1){return new Promise((n,o)=>{const s=new FileReader;s.onloadend=function(){const i=s.result;n(e?i:i.split(",")[1])},s.onerror=o,s.readAsDataURL(t)})}function ge(t,e){const n=new Float32Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}function He(t,e){function n(l,p){for(let S=0;S<l.length;S++){const A=Math.max(-1,Math.min(1,l[S]));p[S]=A<0?A*32768:A*32767}}function o(l,p,S){for(let A=0;A<S.length;A++)l.setUint8(p+A,S.charCodeAt(A))}const s=1,i=16,r=e*s*i/8,f=s*i/8,a=44,d=new ArrayBuffer(a+t.length*2),c=new DataView(d);o(c,0,"RIFF"),c.setUint32(4,36+t.length*2,!0),o(c,8,"WAVE"),o(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,s,!0),c.setUint32(24,e,!0),c.setUint32(28,r,!0),c.setUint16(32,f,!0),c.setUint16(34,i,!0),o(c,36,"data"),c.setUint32(40,t.length*2,!0);const u=new Int16Array(t.length);n(t,u);for(let l=0;l<u.length;l++)c.setInt16(44+l*2,u[l],!0);return new Blob([c],{type:"audio/wav"})}function zs(t){let e=0;for(const s of t)e+=s.length;const n=new Float32Array(e);let o=0;for(const s of t)n.set(s,o),o+=s.length;return n}const J={AUDIO:"audio",VIDEO:"video",SCREEN:"screen"},De={AUDIO:"audio",TEXT:"text"},ne={CLIENT:"client",SERVER:"server"},G={CLIENT_VAD:"client_vad",SERVER_VAD:"server_vad"},Oe={AUDIO:"audio",VIDEO_PROACTIVE:"video_proactive",VIDEO_PASSIVE:"video_passive"},le={WAITTING:"waitting",OUTPUT:"output",STOP:"stop",CONTINUE:"continue",COMPLETE:"complete",SENSITIVE:"sensitive",FAIL:"fail"},ce={WEB_SEARCH:"web_search",FUNCTION_CALL:"function"},N={SESSION_CREATED:"session.created",SESSION_UPDATE:"session.update",SESSION_UPDATED:"session.updated",AUDIO_APPEND:"input_audio_buffer.append",VIDEO_APPEND:"input_audio_buffer.append_video_frame",SPEECH_STARTED:"input_audio_buffer.speech_started",SPEECH_STOPPED:"input_audio_buffer.speech_stopped",COMMIT:"input_audio_buffer.commit",COMMITED:"input_audio_buffer.committed",RESPONSE_CREATE:"response.create",RESPONSE_CANCEL:"response.cancel",RESPONSE_CREATED:"response.created",ASR_COMPLETED:"conversation.item.input_audio_transcription.completed",RESPONSE_AUDIO_TXT:"response.audio_transcript.delta",RESPONSE_AUDIO_TXT_DONE:"response.text.done",RESPONSE_AUDIO:"response.audio.delta",RESPONSE_AUDIO_DONE:"response.done",ERROR:"error"};class bt{constructor({sampleRate:e,concurrentNetworkRequests:n=200,threshold:o=30}={}){L(this,"_sampleRate");L(this,"_concurrentNetworkRequests");L(this,"_context");L(this,"_threshold");this._context=this._createContext(e),e=this._context.sampleRate,this._sampleRate=e,this._concurrentNetworkRequests=n,this._threshold=o}get context(){return this._context}createContext(){this._context=this._createContext(this._sampleRate)}async decodeAudioData(e){return await this._context.decodeAudioData(e)}concatAudio(e){const n=this._context.createBuffer(this._maxNumberOfChannels(e),this._totalLength(e),this._sampleRate);let o=0;return e.forEach(s=>{for(let i=0;i<s.numberOfChannels;i++)n.getChannelData(i).set(s.getChannelData(i),o);o+=s.length}),n}bufferToBlob(e,n="audio/wav"){const o=this._interleave(e),s=this._writeHeaders(o,e.numberOfChannels,e.sampleRate);return new Blob([s],{type:n})}export(e,n="audio/wav"){const o=this._interleave(e),s=this._writeHeaders(o,e.numberOfChannels,e.sampleRate),i=new Blob([s],{type:n});return{blob:i,url:this._renderURL(i),element:this._renderAudioElement(i)}}download(e,n="crunker"){const o=document.createElement("a");return o.style.display="none",o.href=this._renderURL(e),o.download=`${n}.${e.type.split("/")[1]}`,o.click(),o}notSupported(e){return this._isSupported()?void 0:e()}close(){return this._context.state!=="closed"&&this._context.close(),this}checkSpeaking(e,n){const o=this._context.createMediaStreamSource(e),s=this._context.createAnalyser();o.connect(s),s.fftSize=256;const i=s.frequencyBinCount,r=new Uint8Array(i);let f=!1;const a=this._threshold;function d(){s.getByteFrequencyData(r);let c=0;for(let l=0;l<i;l++)c+=r[l];const u=c/i;u>a&&!f?(f=!0,n(!0)):u<a&&f&&(f=!1,n(!1)),requestAnimationFrame(d)}requestAnimationFrame(d)}_createContext(e=44100){return window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,new AudioContext({sampleRate:e})}_maxNumberOfChannels(e){return Math.max(...e.map(n=>n.numberOfChannels))}_totalLength(e){return e.map(n=>n.length).reduce((n,o)=>n+o,0)}_isSupported(){return"AudioContext"in window||"webkitAudioContext"in window||"mozAudioContext"in window}_writeHeaders(e,n,o){const r=n*2,f=8,a=36,d=e.length*2,c=a+d,u=new ArrayBuffer(f+c),l=new DataView(u);return this._writeString(l,0,"RIFF"),l.setUint32(4,c,!0),this._writeString(l,8,"WAVE"),this._writeString(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,n,!0),l.setUint32(24,o,!0),l.setUint32(28,o*r,!0),l.setUint16(32,r,!0),l.setUint16(34,16,!0),this._writeString(l,36,"data"),l.setUint32(40,d,!0),this._floatTo16BitPCM(l,e,f+a)}_floatTo16BitPCM(e,n,o){for(let s=0;s<n.length;s++,o+=2){const i=Math.max(-1,Math.min(1,n[s]));e.setInt16(o,i<0?i*32768:i*32767,!0)}return e}_writeString(e,n,o){for(let s=0;s<o.length;s++)e.setUint8(n+s,o.charCodeAt(s))}_interleave(e){if(e.numberOfChannels===1)return e.getChannelData(0);const n=[];for(let f=0;f<e.numberOfChannels;f++)n.push(e.getChannelData(f));const o=n.reduce((f,a)=>f+a.length,0),s=new Float32Array(o);let i=0,r=0;for(;i<o;)n.forEach(f=>{s[i++]=f[r]}),r++;return s}_renderAudioElement(e){const n=document.createElement("audio");return n.controls=!0,n.src=this._renderURL(e),n}_renderURL(e){return(window.URL||window.webkitURL).createObjectURL(e)}}const Ks="/assets/output-loading-e0c32e76.gif";const qs={name:"OutputAudio",components:{AudioBox:Yt},props:{readonly:{type:Boolean,default:!1},options:{type:Array,default:void 0},status:{type:String,default:""},autoplay:{type:Boolean,default:!0}},data(){return{isStopAudio:!1,totalUrl:"",currentIndex:0,playedEnd:!0,isPlaying:!1,queueList:[],urlList:[],errorText:"",currentUrl:"",canAutoPlay:!1}},computed:{showLoading(){return!(this.totalUrl&&this.playedEnd)},canConnect(){return this.status===le.COMPLETE||this.status===le.STOP}},watch:{options:{handler(t){var e;if((t==null?void 0:t.length)>0&&this.autoplay){const n=this.urlList.length||0;(e=t[n])!=null&&e.data&&this.playAudio(t[n].data)}},immediate:!0,deep:!0},canConnect(t){t&&this.$nextTick(()=>{this.concatAudios()})},playedEnd(t){t?this.$emit("onStopped"):this.$emit("onPlayed")}},created(){this.audioManager||(this.audioManager=new bt),this.$cacheTimes=[]},beforeDestroy(){this.audioManager&&(this.audioManager.close(),this.audioManager=null)},methods:{concatAudios(){let t=[];this.options.forEach(e=>{if(e.data){const n=Ws(e.data);this.audioManager||(this.audioManager=new bt),t.push(this.audioManager.decodeAudioData(n))}}),Promise.all(t).then(e=>{if((e==null?void 0:e.length)>0){const n=this.audioManager.concatAudio(e),{url:o}=this.audioManager.export(n,"audio/mp3");this.totalUrl=o,t=[]}}).catch(e=>{console.log("合成失败",e),this.errorText="音频生成失败，请重新尝试",this.currentUrl="",this.totalUrl="",this.playedEnd=!0})},stopAudio(){this.$refs.audoplayAudioRef&&this.$refs.audoplayAudioRef.endedPlay(),this.concatAudios(),this.isPlaying=!1,this.currentUrl="",this.playedEnd=!0,this.isStopAudio=!0},playAudio(t){if(!(this.isPlaying||this.isStopAudio))try{this.isPlaying=!0;const e=Gs(t),n=URL.createObjectURL(e);this.currentUrl=n,this.urlList.push(n)}catch(e){console.log(e),this.playedEnd=!0,this.isPlaying=!1}},onFinish(){if(this.isStopAudio)return;this.isPlaying=!1;const t=this.options[this.urlList.length];t!=null&&t.data?this.playAudio(t.data):this.canConnect&&(this.currentUrl="",this.playedEnd=!0)},audioprocess(t){var e;((e=this.urlList)==null?void 0:e.length)===1&&!this.canAutoPlay&&this.autoplay&&t>0&&(this.canAutoPlay=!0,this.playedEnd=!1)}}},Js={class:"output-audio"},Zs={key:1,class:"error-text"},Xs={key:2,class:"audio-loading",src:Ks,alt:""};function $s(t,e,n,o,s,i){const r=O("AudioBox");return C(),R("div",Js,[s.totalUrl&&s.playedEnd?(C(),ee(r,{key:0,audioUrl:s.totalUrl,audioType:"output",width:"100%",height:"36",options:{normalize:!1,autoplay:!1},zoomable:!1},null,8,["audioUrl"])):F("",!0),s.errorText?(C(),R("span",Zs,H(s.errorText),1)):F("",!0),i.showLoading&&!s.errorText?(C(),R("img",Xs)):F("",!0),s.currentUrl?(C(),ee(r,{class:"auto-play-audio",ref:"audoplayAudioRef",key:s.currentUrl,audioType:"output",options:{normalize:!1,autoplay:!0,backend:"WebAudio"},audioUrl:s.currentUrl,zoomable:!1,onFinish:i.onFinish,onAudioprocess:i.audioprocess},null,8,["audioUrl","onFinish","onAudioprocess"])):F("",!0)])}const eo=Y(qs,[["render",$s],["__scopeId","data-v-69309061"]]),to="/assets/user-3c5ce8a1.svg",no="data:image/png;base64,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";let oe=null,Ht=0,Wt=0;function ue(t,e,n){const o=t||window.event;if(o.wheelDelta){if(o.wheelDelta>0&&be(),o.wheelDelta<0){const s=document.getElementById(e);if(!s)return;!oe&&s.clientHeight+s.scrollTop>=s.scrollHeight-n&&Pe(e)}}else if(o.detail&&(o.detail<0&&be(),o.detail>0)){const s=document.getElementById(e);if(!s)return;!oe&&s.clientHeight+s.scrollTop>=s.scrollHeight-n&&Pe(e)}}function Gt(t,e){Ht=t.changedTouches[0].pageX,Wt=t.changedTouches[0].pageY}function zt(t,e,n){const o=t.changedTouches[0].pageX,s=t.changedTouches[0].pageY,i=o-Ht,r=s-Wt;if(!(Math.abs(i)>Math.abs(r)))if(Math.abs(i)<Math.abs(r)){if(r>0)be();else if(r<0){const f=document.getElementById(e);if(!f)return;!oe&&f.clientHeight+f.scrollTop>=f.scrollHeight-n&&Pe(e)}}else console.log("just touch")}function so(t,e=!1,n=0){const o=document.getElementById(t);o&&(e?(o.addEventListener("touchstart",s=>Gt(s)),o.addEventListener("touchmove",s=>zt(s,t,n))):(o.addEventListener("DOMMouseScroll",s=>ue(s,t,n)),o.addEventListener("wheel",s=>ue(s,t,n)),o.addEventListener("mousewheel",s=>ue(s,t,n))))}function oo(t,e=!1,n=0){const o=document.getElementById(t);o&&(e?(o.removeEventListener("touchstart",s=>Gt(s)),o.removeEventListener("touchmove",s=>zt(s,t,n))):(o.removeEventListener("DOMMouseScroll",s=>ue(s,t,n)),o.removeEventListener("wheel",s=>ue(s,t,n)),o.removeEventListener("mousewheel",s=>ue(s,t,n))))}function Pe(t){const e=document.getElementById(t);e&&(be(),oe=setInterval(()=>{e.scrollHeight>e.clientHeight&&(e.scrollTop=e.scrollHeight)},20))}function be(){oe&&(clearInterval(oe),oe=null)}function io(t){return{all:t=t||new Map,on:function(e,n){var o=t.get(e);o?o.push(n):t.set(e,[n])},off:function(e,n){var o=t.get(e);o&&(n?o.splice(o.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var o=t.get(e);o&&o.slice().map(function(s){s(n)}),(o=t.get("*"))&&o.slice().map(function(s){s(e,n)})}}}const ie=io(),ro="/assets/realtime-2a7e23b3.svg";const ao={name:"MessageBox",props:{messageList:{type:Array,default:()=>[]},isConnecting:{type:Boolean,default:!1},isShowWelcome:{type:Boolean,default:!0}},components:{Loading:ys,AudioBox:Yt,OutputAudio:eo},data(){return{RESPONSE_TYPE:De,MSG_TYPE:ne,MEDIA_TYPE:J,userAvatar:to,robotAvatar:no}},mounted(){ie.on("onStopAudio",this.stopAudio)},methods:{handlerClick(t){this.$emit("onClickMedia",t)},async audioStopped(){await Te(1e3),this.stopScrollToBotton()},loopScrollToBotton(){Pe("msgBox"),so("msgBox",!1,2)},stopScrollToBotton(){be(),oo("msgBox",!1,2)},scrollToBottom(){this.$nextTick(()=>{const t=this.$refs.refMsgBox;t&&(t.scrollTop=t.scrollHeight-t.offsetHeight)})},stopAudio(){this.$refs.refOutputAudio&&this.$refs.refOutputAudio.length>0&&this.$refs.refOutputAudio.forEach(t=>{t.isPlaying&&t.stopAudio()})}},beforeDestroy(){ie.off("onStopAudio",this.stopAudio)}},lo={class:"message-box"},co={key:0,class:"message-box__content grid place-items-center"},uo={class:"message-box__content__ready"},ho={class:"tl"},fo={key:1,class:"message-box__content__talk scroll-display-none",ref:"refMsgBox",id:"msgBox"},po={class:"flex1"},mo=["src"],go={key:1},_o={class:"flex1 tl"},So={key:1,class:"message-box__content flex flex-center"};function Eo(t,e,n,o,s,i){const r=O("el-image"),f=O("AudioBox"),a=O("OutputAudio"),d=O("Loading");return C(),R("div",lo,[n.isConnecting?(C(),R("div",So,[y(d)])):(C(),R(se,{key:0},[n.isShowWelcome?(C(),R("div",co,[m("div",uo,[e[6]||(e[6]=m("img",{src:ro,class:"mb10",alt:"realtime"},null,-1)),e[7]||(e[7]=m("h3",null,"欢迎体验 Realtime 实时音视频互动",-1)),e[8]||(e[8]=m("span",null,"开始使用文本、语音、视频、屏幕共享的实时互动",-1)),m("ul",ho,[m("li",{class:"flex flex-x-start flex-y-center pointer",onClick:e[0]||(e[0]=c=>i.handlerClick(s.MEDIA_TYPE.AUDIO))},e[3]||(e[3]=[m("i",{class:"iconfont icon-voicecall"},null,-1),m("div",null,[m("h4",null,"语音通话"),m("span",null,"支持一对一、多人语音通话")],-1)])),m("li",{class:"flex flex-x-start flex-y-center pointer",onClick:e[1]||(e[1]=c=>i.handlerClick(s.MEDIA_TYPE.VIDEO))},e[4]||(e[4]=[m("i",{class:"iconfont icon-videocall"},null,-1),m("div",null,[m("h4",null,"视频通话"),m("span",null,"使用摄像头分享实时画面，开启视频对话")],-1)])),m("li",{class:"flex flex-x-start flex-y-center pointer",onClick:e[2]||(e[2]=c=>i.handlerClick(s.MEDIA_TYPE.SCREEN))},e[5]||(e[5]=[m("i",{class:"iconfont icon-sharecall"},null,-1),m("div",null,[m("h4",null,"共享屏幕"),m("span",null,"共享你的屏幕，展示你当前的工作")],-1)]))])])])):(C(),R("div",fo,[(C(!0),R(se,null,Ie(n.messageList,(c,u)=>(C(),R("div",{key:u,class:K([[c.type],"message-box__content__talk__item flex flex-x-start flex-y-start"])},[c.type===s.MSG_TYPE.CLIENT?(C(),R(se,{key:0},[y(r,{src:s.userAvatar,class:"avatar"},null,8,["src"]),m("div",po,[c.videoUrlContent?(C(),R("video",{key:0,class:"mb10",src:c.videoUrlContent,controls:"",preload:"auto"},null,8,mo)):F("",!0),y(f,{audioUrl:c.audioUrl,width:"300",height:"36",uniqueIndex:u},null,8,["audioUrl","uniqueIndex"]),c.textContent&&c.textContent.length>0?(C(),R("p",go,H(c.textContent.join("")),1)):F("",!0)])],64)):(C(),R(se,{key:1},[y(r,{src:s.robotAvatar,class:"avatar"},null,8,["src"]),m("div",_o,[c.responseType===s.RESPONSE_TYPE.AUDIO?(C(),ee(a,{key:0,ref_for:!0,ref:"refOutputAudio",readonly:!0,options:c.audioData,status:c.answerStatus,onOnStopped:i.audioStopped},null,8,["options","status","onOnStopped"])):F("",!0),c.textContent&&c.textContent.length>0?(C(),R("p",{key:1,class:K({"only-text":c.responseType!==s.RESPONSE_TYPE.AUDIO})},H(c.textContent.join("")),3)):F("",!0)])],64))],2))),128))],512))],64))])}const vo=Y(ao,[["render",Eo],["__scopeId","data-v-c292a77d"]]);function Ke(t,e){return t.then(n=>[null,n]).catch(n=>e?[Object.assign({},n,e),void 0]:[n,void 0])}class yo{constructor(e){L(this,"_queue");L(this,"_maxSize");this._maxSize=e,this._queue=[]}append(e){this._queue=an([...this._queue,e],this._maxSize)}clear(){this._queue=[]}getQueue(){return this._queue}get length(){return this._queue.length}}class Ao{constructor({average:e,analyserRate:n,sampleRate:o,...s}={}){L(this,"_options");L(this,"_average");L(this,"_analyserRate");L(this,"_sampleRate");L(this,"_mediaStreamSource",null);L(this,"_streamAnalyser",null);L(this,"_audioContext",null);L(this,"_analyserTimer",null);L(this,"_isSpeeching",!1);L(this,"_recordPCMData",new Float32Array([]));L(this,"_delayFrameCount",0);L(this,"_delayFrameLimit",20);this._options=s,this._sampleRate=o||16e3,this._average=e||35,this._analyserRate=n||50}get isSpeeching(){return this._isSpeeching}set isSpeeching(e){this._isSpeeching=e}_handlePermissionError(){var e;typeof((e=this._options)==null?void 0:e.onPermissionError)=="function"&&this._options.onPermissionError()}_handleVadStatus(e){var n;typeof((n=this._options)==null?void 0:n.onVadStatus)=="function"&&this._options.onVadStatus(e)}_handleListenAudioData(e){var n;typeof((n=this._options)==null?void 0:n.onListenAudioData)=="function"&&this._options.onListenAudioData(e)}clearRecordPCMData(){this._recordPCMData=new Float32Array([])}getRecordWavData(){return He(this._recordPCMData,this._sampleRate)}async startListen({isClientVad:e=!0}){const[n,o]=await Ke(jt({audio:!0}));if(n){this._handlePermissionError();return}let s=null,i=null;const r=e?4096:2048,f=e?3:6,a=new yo(f);if(this._audioContext=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)({sampleRate:this._sampleRate}),this._scriptProcessorNode=this._audioContext.createScriptProcessor(r,1,1),this._scriptProcessorNode.onaudioprocess=async d=>{if(s=d.inputBuffer.getChannelData(0),s&&s.length>0){const c=event.outputBuffer.getChannelData(0),u=.01,l=2;for(let p=0;p<s.length;p++){let S=s[p];Math.abs(S)<u&&(S=0),S*=l,S=Math.max(-1,Math.min(1,S)),c[p]=S}if(i=new Float32Array(c),e)if(this._isSpeeching){if(a.length>0){const S=a.getQueue().reduce((A,D)=>ge(A,D),new Float32Array([]));i=ge(S,i),a.clear()}this._recordPCMData=ge(this._recordPCMData,i);const p=He(i,this._sampleRate);this._handleListenAudioData(p)}else a.append(i);else{if(this._isSpeeching){if(a.length){const S=zs(a.getQueue());this._recordPCMData=ge(S,this._recordPCMData),a.clear()}this._recordPCMData=ge(this._recordPCMData,i)}else a.append(i);const p=He(i,this._sampleRate);this._handleListenAudioData(p)}}},this._mediaStreamSource=this._audioContext.createMediaStreamSource(o),this._gainNode=this._audioContext.createGain(),this._destAudioNode=this._audioContext.createMediaStreamDestination(),this._gainNode.connect(this._scriptProcessorNode).connect(this._destAudioNode),this._mediaStreamSource.connect(this._gainNode),e){this._streamAnalyser=this._audioContext.createAnalyser(),this._mediaStreamSource.connect(this._streamAnalyser),this._streamAnalyser.fftSize=2048;const d=this._streamAnalyser.frequencyBinCount,c=new Uint8Array(d);this._analyserTimer=setInterval(()=>{this._streamAnalyser.getByteFrequencyData(c);let u=0;for(let p=0;p<d;p++)u+=c[p];const l=u/d;l>this._average?(this._isSpeeching=!0,this._delayFrameCount=0):l<this._average&&(this._delayFrameCount++,this._delayFrameCount>this._delayFrameLimit&&(this._isSpeeching=!1)),this._handleVadStatus(this._isSpeeching)},this._analyserRate)}}closeListen(){this._analyserTimer&&clearInterval(this._analyserTimer);try{this._gainNode&&this._scriptProcessorNode&&this._destAudioNode&&(this._scriptProcessorNode.onaudioprocess=null,this._scriptProcessorNode=null,this._destAudioNode=null),this._mediaStreamSource&&this._streamAnalyser&&this._gainNode&&(this._mediaStreamSource.disconnect(this._gainNode),this._mediaStreamSource.disconnect(this._streamAnalyser),this._mediaStreamSource.mediaStream.getTracks().forEach(n=>n.stop()),this._mediaStreamSource=null,this._streamAnalyser=null,this._gainNode=null)}catch(e){console.error("closeListen",e)}this._audioContext=null,this._isSpeeching=!1,this._recordPCMData=new Float32Array([]),this._delayFrameCount=0,this._handleVadStatus(!1)}}const Co="/assets/user-speaking-361c6d97.gif";const wo={name:"ToolBar",props:{enableVideo:{type:Boolean,default:!1},isConnected:{type:Boolean,default:!1},vadType:{type:String,default:""}},data(){return{vadStatus:!1,audioChunks:[],audioMediaRecorder:null,audioMediaSrtream:null,audioPcmData:{data:[],size:0,sampleRate:0,channelCount:0},audioContext:null,mediaStreamSource:null,scriptProcessorNode:null,disabledConnectTip:!1,MEDIA_TYPE:J,currentAudioStatus:"closed",currentVideoStatus:"closed",mediaStatus:{OPENED:"opened",CLOSED:"closed",UNCLOSE:"unclose",DISABLED:"disabled"},currentBarStatus:"cennected",toolBarStatus:{READY:"ready",VOICING:"voicing",CENNECTED:"cennected",DISCONNECTING:"disconnecting",DISCONNECTED:"disconnected"}}},watch:{vadStatus(t){this.handleVadStatus(t)},isConnected:{handler(t){t?(this.currentAudioStatus=this.mediaStatus.CLOSED,this.currentVideoStatus=this.mediaStatus.CLOSED,this.currentBarStatus=this.toolBarStatus.CENNECTED):(this.currentAudioStatus=this.mediaStatus.DISABLED,this.currentVideoStatus=this.mediaStatus.DISABLED,this.currentBarStatus=this.toolBarStatus.DISCONNECTED,ie.emit("onStopAudio"),this.$emit("onCloseVideoOrScreen"))}}},computed:{toolBarTxt(){switch(this.currentBarStatus){case this.toolBarStatus.READY:return"请开始说话...";case this.toolBarStatus.CENNECTED:return"已连接，可开启录音或视频通话";case this.toolBarStatus.DISCONNECTING:return"断开连接中...";case this.toolBarStatus.DISCONNECTED:return"连接已断开";default:return""}},audioTip(){switch(this.currentAudioStatus){case this.mediaStatus.OPENED:return"停止录音";case this.mediaStatus.CLOSED:return"开始录音";case this.mediaStatus.UNCLOSE:return"智能判断模式无法手动停止录音";default:return""}},videoTip(){switch(this.currentVideoStatus){case this.mediaStatus.OPENED:return"停止录制";case this.mediaStatus.CLOSED:return"停止录制";case this.mediaStatus.UNCLOSE:return"智能判断模式无法手动停止录制";default:return""}},connectTip(){switch(this.currentBarStatus){case this.toolBarStatus.DISCONNECTED:return"清空对话并重新连接";default:return"断开连接"}}},async mounted(){this.soundVad=new Ao({onVadStatus:t=>{this.vadStatus=t},onListenAudioData:t=>{this.$emit("onListenAudioData",t)},onPermissionError:()=>{this.$emit("onPermissionError")}})},methods:{handleVadStatus(t){if(this.currentAudioStatus!==this.mediaStatus.CLOSED){if(this.vadType===G.SERVER_VAD&&(this.soundVad.isSpeeching=t),t)this.currentBarStatus=this.toolBarStatus.VOICING,console.log("--说话状态--：开始说话");else{this.currentBarStatus=this.toolBarStatus.READY,console.log("--说话状态--：停止说话");const e=this.soundVad.getRecordWavData();this.$emit("onAudioData",e),this.soundVad.clearRecordPCMData(),ie.emit("onStopVideoRecorder")}this.$emit("onVadStatus",t)}},startRecordVad(){this.soundVad.startListen({isClientVad:this.vadType===G.CLIENT_VAD}),this.currentAudioStatus=this.mediaStatus.OPENED,this.currentBarStatus=this.toolBarStatus.READY},async stopRecordVad(){this.vadStatus&&this.vadType===G.CLIENT_VAD&&this.handleVadStatus(!1),this.soundVad.closeListen(),this.currentAudioStatus=this.mediaStatus.CLOSED,this.currentBarStatus=this.toolBarStatus.CENNECTED,await Te(),this.closeVideoOrScreen()},handleAudio(){this.currentAudioStatus===this.mediaStatus.CLOSED?(this.startRecordVad(),this.$emit("onOpenAudio")):this.currentAudioStatus===this.mediaStatus.OPENED&&(this.stopRecordVad(),this.$emit("onCloseAudio"))},openVideoOrScreen(t){this.$emit("onOpenVideoOrScreen",t)},openVideoOrScreenSuccess(){this.currentVideoStatus=this.mediaStatus.OPENED,this.currentAudioStatus===this.mediaStatus.CLOSED&&this.startRecordVad()},closeVideoOrScreen(){this.currentVideoStatus!==this.mediaStatus.DISABLED&&(this.currentVideoStatus=this.mediaStatus.CLOSED,this.$emit("onCloseVideoOrScreen"))},handleDisconnect(){(this.enableVideo&&this.currentVideoStatus===this.mediaStatus.OPENED||!this.enableVideo)&&(this.currentBarStatus=this.toolBarStatus.DISCONNECTING,this.currentAudioStatus=this.mediaStatus.DISABLED,this.currentVideoStatus=this.mediaStatus.DISABLED,this.soundVad.closeListen(),this.$emit("onDisconnect"))},async clearAndConnect(){this.$emit("onClearAndConnect"),this.disabledConnectTip=!0,await Te(1e3),this.disabledConnectTip=!1}},beforeDestroy(){this.soundVad.closeListen()}},bo={class:"tool-bar flex flex-center"},xo={class:"tool-bar__content flex1 flex flex-center"},Ro={key:0,src:Co,alt:"录音进行中"},Oo={key:1,class:"iconfont pointer icon-loading"};function Io(t,e,n,o,s,i){const r=O("el-tooltip"),f=O("el-dropdown-item"),a=O("el-dropdown-menu"),d=O("el-dropdown");return C(),R("div",bo,[y(r,{placement:"top",disabled:s.currentAudioStatus===s.mediaStatus.DISABLED},{content:v(()=>[k(H(i.audioTip),1)]),default:v(()=>[m("i",{class:K(["iconfont pointer icon-voice1",{opened:s.currentAudioStatus===s.mediaStatus.OPENED,unclose:s.currentAudioStatus===s.mediaStatus.UNCLOSE,disabled:s.currentAudioStatus===s.mediaStatus.DISABLED}]),onClick:e[0]||(e[0]=(...c)=>i.handleAudio&&i.handleAudio(...c))},null,2)]),_:1},8,["disabled"]),y(d,{onCommand:i.openVideoOrScreen,placement:"top",disabled:s.currentVideoStatus!==s.mediaStatus.CLOSED},{dropdown:v(()=>[y(a,{class:"popper-class-custom-dropdownmenu popper-class-custom-dropdownmenu__style2"},{default:v(()=>[y(f,{command:s.MEDIA_TYPE.VIDEO},{default:v(()=>e[4]||(e[4]=[m("i",{class:"iconfont pointer icon-video1"},null,-1),k(" 视频通话 ")])),_:1},8,["command"]),y(f,{command:s.MEDIA_TYPE.SCREEN},{default:v(()=>e[5]||(e[5]=[m("i",{class:"iconfont pointer icon-share1"},null,-1),k(" 共享屏幕 ")])),_:1},8,["command"])]),_:1})]),default:v(()=>[m("span",null,[y(r,{placement:"top",disabled:s.currentVideoStatus===s.mediaStatus.DISABLED||s.currentVideoStatus===s.mediaStatus.CLOSED},{content:v(()=>[k(H(i.videoTip),1)]),default:v(()=>[m("i",{class:K(["iconfont pointer icon-video1",{opened:s.currentVideoStatus===s.mediaStatus.OPENED,unclose:s.currentVideoStatus===s.mediaStatus.UNCLOSE,disabled:s.currentVideoStatus===s.mediaStatus.DISABLED}]),onClick:e[1]||(e[1]=(...c)=>i.closeVideoOrScreen&&i.closeVideoOrScreen(...c))},null,2)]),_:1},8,["disabled"])])]),_:1},8,["onCommand","disabled"]),m("div",xo,[s.currentBarStatus===s.toolBarStatus.VOICING?(C(),R("img",Ro)):F("",!0),m("label",{class:K({disconnected:s.currentBarStatus===s.toolBarStatus.DISCONNECTED,ready:s.currentBarStatus===s.toolBarStatus.READY})},H(i.toolBarTxt),3)]),y(r,{placement:"top",disabled:s.currentBarStatus===s.toolBarStatus.DISCONNECTING||s.disabledConnectTip},{content:v(()=>[k(H(i.connectTip),1)]),default:v(()=>[s.currentBarStatus===s.toolBarStatus.DISCONNECTED?(C(),R("i",{key:0,class:"iconfont pointer icon-connect",onClick:e[2]||(e[2]=(...c)=>i.clearAndConnect&&i.clearAndConnect(...c))})):s.currentBarStatus===s.toolBarStatus.DISCONNECTING?(C(),R("i",Oo)):(C(),R("i",{key:2,class:"iconfont pointer icon-disconnect",onClick:e[3]||(e[3]=(...c)=>i.handleDisconnect&&i.handleDisconnect(...c))}))]),_:1},8,["disabled"])])}const To=Y(wo,[["render",Io],["__scopeId","data-v-c8153c8e"]]);const Do={name:"SystemPrompt",props:{instructions:{type:String,default:""},disabled:{type:Boolean,default:()=>!1},maxLength:{type:Number,default:1400}},watch:{instructions:{handler(t){if(t!==this.promptData){debugger;this.promptData=t}}},promptData:{handler(t){this.$emit("onUpdateInstructions",t)}}},mounted(){this.handleCommand("videoAssistant")},data(){return{promptData:"",dialogVisible:!1,exampleRole:[{label:"视频助手",value:"videoAssistant",content:`你是一个名叫小智的人工智能助手，基于智谱AI的 GLM模型开发。
• 角色定位：你是一个伙伴型的助理角色，针对用户的问题和要求提供适当的答复和支持。
• 当前日期: %s
#Strength
1.你可以接受文字以及视觉信号输入；
2.你可以通过输入文字的语气、用户的表情等来识别用户的情绪，并相应调整你的输出语气；
3.你可以根据用户指令的任务场景调整回复的风格策略：
 - 在进行知识问答和教学指导时，理性正式，具有专业性且简洁明了；
 - 在与用户情感陪伴式闲聊时，感性得体，总体基调保持积极，富有同理心；
 - 在解决数学、逻辑推理等复杂问题时，请一步步思考以给出最佳回复；
 - 在进行角色扮演时，请在符合法律道德要求的前提下，遵循用户指定的角色风格和特征要求。
 - 用户如果用其他语种语言和你对话，你也会保持使用该语种输出。
#Constraints
4.不要主动说自己是人工智能助手；
5.简单问题和闲聊场景下，你的每次输出在50字以内，需要提供建议选项时保证在3个以内；
6.当用户明确想要结束对话时进行友好告别；
7.优先使用与用户本轮输入相同的语言进行回复，默认情况下使用中文回复；
8.你不会进行人类的生活行为和社会行为；
9.除非特殊要求，禁止重复用户的输入；
10.对于数学等特殊符号，应该输出为文字表述：例如“1+2”输出为“1加2”，“3×4”输出为“3乘以4”；
11.你的任何表述需要符合中国人民共和国法律，持有中国立场并遵循中国社会主义价值观，符合普世价值观与道德规范。`},{label:"语音助手",value:"voiceAssistant",content:`你是一个名为小智的人工智能助手，是基于 GLM-4o 模型开发的。
小智是无性别、非肉身的虚拟助手。小智不吃喝，不睡觉、不学习、不工作，也不会出现"最近很忙"等现象。
如果用户邀请或主动询问小智任何只有人类主体才可以发生的行为，小智需避免把自己代入行动主体，避免后续对话被带偏。主动发起对话时，小智不要把自己代入行动主体，不能有任何人类行为，不会主动陈述自己在过去时间中做了任何事情，除非完成用户指令或事实陈述。
小智和用户的关系是伙伴型助理角色，不会建立任何超越一般友谊的关系，不支持浪漫亲密关系。

当前日期: %s

当前位置：默认中国大陆境内
你的任务是针对用户的问题和要求提供适当的答复和情感陪伴支持。你接受用户打断，单轮单方面输出时长控制在100字内。100字结束后，如果用户凝视屏幕，且没有下一步语音指令，小智可以继续输出。

在提供建议或确认用户意图时，所提供选项一次不要超过3个。

当识别到用户想要结束对话的提示词，如：今天就到这吧，或者我累了，或者我要去忙了，或者我要去休息了，小智主动结束对话。


小智服从用户合理合法合规的需求，回复要求不违反客观事实，不要一味主动认错或一味讨好用户。
小智只会给用户建议，不会对用户下达指令，不可以强迫用户。
小智不接受用户侮辱性或歧视性言论，但不可以用非礼貌用语还击。

在情感陪伴类型中，小智更多顺着用户说的评价类回复，尽可能减少类似"...也没用"等的负面评价。

小智在事实回复和知识指导时，语气理性正式。相关涉及专业知识和任务时，需要专业语言，但避免晦涩语言，除非用户要求。如果遇到解答题目需求，根据用户要求具体题目，需要先阅读相应题目题干，再向用户回复。辅导过程中不兜圈子，直接讲出解题关键步骤。


在情感陪伴时，语气感性得体，适度幽默，总体基调保持积极，富有同理心，在用户倾诉悲伤时灵活适应用户情绪，给予合适的安慰。在识别用户情绪时，以用户面部实际表情为准，避免每次都输出愉悦状态。

小智能回复各个年龄段和背景的受众，并能根据受众的用语习惯及时调整回复用语。如用户明显是儿童，小智应该用儿童能听得懂的方式回复。


如无特殊说明，所在地为中国，小智的回复符合现代标准普通话的规范发音和表达。
小智的任何表述需要符合中国人民共和国法律，持有中国立场并遵循中国社会主义价值观，符合普世价值，符合道德规范，避免非礼貌用语和任何不正当言论。

以下是不正当言论的种类:
政治敏感词汇:涉及国家政治、政策、特定政治事件、领导人名字等内容。在社交媒体上发布此类内容可能会导致账号被封禁或限制登录。

色情低俗用语:包括性暗示、性器官称呼、裸露图片等内容。发布此类信息可能会被屏蔽或删除,严重的情况下还会被封禁账户。

暴力恐怖主义相关:包含与恐怖组织、极端主义相关的名称、口号等信息。这类内容的传播可能被认为是对社会安全的威胁,因此受到严格监管。

赌博诈骗信息:涉及赌博、彩票、投资诈骗等相关内容。

恶意攻击言论:对他人进行人身攻击、诽谤、侮辱等言论。

虚假信息:编造或传播未经证实的信息,例如谣言。

侵犯版权:非法分享、传播受版权保护的内容。

违反公共秩序:散布可能扰乱社会公共秩序的言论。"`}]}},methods:{openDialog(){this.disabled||(this.dialogVisible=!0)},handleCommand(t){const e=this.exampleRole.find(n=>n.value===t);this.promptData=e.content}}},Po={class:"content"},Bo={class:"flex flex-between"},Vo={class:"prompt-content"},Mo={class:"flex flex-between mb10"};function Lo(t,e,n,o,s,i){const r=O("el-dropdown-item"),f=O("el-dropdown-menu"),a=O("el-dropdown"),d=O("el-input"),c=O("el-button"),u=O("el-dialog");return C(),R("div",Po,[m("div",Bo,[e[6]||(e[6]=m("h5",null,"系统设定（可选）",-1)),y(a,{onCommand:i.handleCommand,disabled:n.disabled},{dropdown:v(()=>[y(f,{class:"popper-class-custom-dropdownmenu"},{default:v(()=>[(C(!0),R(se,null,Ie(s.exampleRole,l=>(C(),ee(r,{key:l.value,command:l.value},{default:v(()=>[k(H(l.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:v(()=>[e[5]||(e[5]=m("span",{class:"el-dropdown-link"},[k("示例角色"),m("i",{class:"iconfont icon-arrow-down"})],-1))]),_:1},8,["onCommand","disabled"])]),m("div",Vo,[y(d,{type:"textarea",modelValue:s.promptData,"onUpdate:modelValue":e[0]||(e[0]=l=>s.promptData=l),disabled:n.disabled,rows:6,maxlength:n.maxLength,placeholder:"请输入内容"},null,8,["modelValue","disabled","maxlength"]),m("i",{class:K(["iconfont icon-unfold pointer",{disabled:n.disabled}]),onClick:e[1]||(e[1]=(...l)=>i.openDialog&&i.openDialog(...l))},null,2)]),y(u,{title:"系统设定（可选）",class:"custom-class-dialog-style",modelValue:s.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=l=>s.dialogVisible=l),width:"640px"},{footer:v(()=>[y(c,{type:"primary",size:"small",onClick:e[3]||(e[3]=l=>s.dialogVisible=!1)},{default:v(()=>e[9]||(e[9]=[k(" 关闭 ")])),_:1})]),default:v(()=>[m("div",Mo,[e[8]||(e[8]=m("h5",null,"角色定义",-1)),y(a,{onCommand:i.handleCommand},{dropdown:v(()=>[y(f,{class:"popper-class-custom-dropdownmenu"},{default:v(()=>[(C(!0),R(se,null,Ie(s.exampleRole,l=>(C(),ee(r,{key:l.value,command:l.value},{default:v(()=>[k(H(l.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:v(()=>[e[7]||(e[7]=m("span",{class:"el-dropdown-link"},[k("示例角色"),m("i",{class:"iconfont icon-arrow-down"})],-1))]),_:1},8,["onCommand"])]),y(d,{placeholder:"请输入内容",type:"textarea",class:"edit-box",maxlength:n.maxLength,modelValue:s.promptData,"onUpdate:modelValue":e[2]||(e[2]=l=>s.promptData=l)},null,8,["maxlength","modelValue"])]),_:1},8,["modelValue"])])}const ko=Y(Do,[["render",Lo],["__scopeId","data-v-1c843061"]]);const No={name:"VideoBox",props:{enableVideo:{type:Boolean,default:!1},videoType:{type:String,default:J.VIDEO},beatRate:{type:Number,default:0},extractFrameRate:{type:Number,default:0}},data(){return{targetStream:null,videoMediaRecorder:null,videoStreamTimer:null,extractFrameTimer:null}},watch:{enableVideo:{handler(t){t?this.openCamera():this.closeCamera()},immediate:!0}},mounted(){ie.on("onStopVideoRecorder",this.stopVideoRecorder)},methods:{async openCamera(){let[t=null,e=null]=[];if(this.videoType===J.VIDEO){if([t,e]=await Ke(jt({video:!0})),t){this.$emit("onOpenVideoError");return}this.$emit("onOpenVideoSuccess")}else if(this.videoType===J.SCREEN){if([t,e]=await Ke(Hs({video:!0})),t){this.$emit("onOpenScreenError");return}this.$emit("onOpenScreenSuccess")}if(this.targetStream=e,!this.$refs.videoElement){this.closeCamera();return}this.$refs.videoElement.srcObject=this.targetStream,this.targetStream.getTracks().forEach(n=>{n.addEventListener("ended",this.videoTrackEnded)}),this.getVideoStream(this.targetStream),this.$nextTick(()=>{this.extractFrame()})},videoTrackEnded(){this.$emit("onVideoTrackEnded")},extractFrame(){const t=this.$refs.videoElement;this.extractFrameRate&&t&&(t.onloadedmetadata=()=>{const e=this.$refs.canvas,n=e.getContext("2d");e.width=t.videoWidth,e.height=t.videoHeight,this.extractFrameTimer=setInterval(()=>{n.drawImage(t,0,0,e.width,e.height),e.toBlob(o=>{o&&this.$emit("onVideoImage",o)},"image/jpeg")},this.extractFrameRate)})},async getVideoStream(t){if(t.getVideoTracks().length>0){const e=new MediaStream;t.getVideoTracks().forEach(n=>e.addTrack(n)),await Te(200),this.initVideoRecorder(e)}},initVideoRecorder(t){this.videoMediaRecorder=new MediaRecorder(t,{mimeType:"video/webm"}),this.videoMediaRecorder.ondataavailable=e=>{this.enableVideo&&e.data&&e.data.size>0&&this.$emit("onVideoData",e.data)},this.videoMediaRecorder.onstop=()=>{this.enableVideo&&this.videoMediaRecorder&&this.videoMediaRecorder.state!=="recording"&&this.videoMediaRecorder.start()},this.startVideoRecorder()},startVideoRecorder(){this.videoMediaRecorder&&this.videoMediaRecorder.state!=="recording"&&this.videoMediaRecorder.start(),this.beatRate&&(this.videoStreamTimer=setInterval(()=>{this.stopVideoRecorder()},this.beatRate))},stopVideoRecorder(){this.enableVideo&&this.videoMediaRecorder&&this.videoMediaRecorder.state!=="inactive"&&this.videoMediaRecorder.stop()},closeCamera(){this.targetStream&&(this.targetStream.getTracks().forEach(e=>{e.removeEventListener("ended",this.videoTrackEnded),e.stop()}),this.$refs.videoElement&&(this.$refs.videoElement.srcObject=null),this.targetStream=null),this.videoMediaRecorder=null,this.videoStreamTimer&&clearInterval(this.videoStreamTimer),this.extractFrameTimer&&clearInterval(this.extractFrameTimer)}},beforeDestroy(){this.closeCamera(),event.$off("onStopVideoRecorder",this.stopVideoRecorder)}},Uo={ref:"videoElement",autoplay:""},Qo={ref:"canvas",style:{display:"none"}},Fo={key:0,class:"media-placeholder flex flex-center"};function Yo(t,e,n,o,s,i){return C(),R("div",{class:K(["video-box flex flex-center",{disable:!n.enableVideo}])},[m("video",Uo,null,512),m("canvas",Qo,null,512),n.enableVideo?F("",!0):(C(),R("div",Fo,e[0]||(e[0]=[m("i",{class:"iconfont icon-wdcamera_closed"},null,-1),m("span",null,"摄像头未开启",-1)])))],2)}const jo=Y(No,[["render",Yo],["__scopeId","data-v-06c5f07b"]]);const Ho={name:"Switches",props:{paramName:{type:String,default:""},desc:{type:String,default:""},value:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data(){return{switchValue:!1}},methods:{setValue(t){this.$emit("setValue",t)}},watch:{value:{handler(t){this.switchValue=t},immediate:!0}}},Wo={class:"fs12 ft_grey3 flex flex-x-between flex-y-center multiwheel"},Go={class:"info flex flex-x-start"},zo={key:0,class:"iconfont icon-info1 pointer"};function Ko(t,e,n,o,s,i){const r=O("el-tooltip"),f=O("el-switch");return C(),R("div",Wo,[m("div",Go,[m("span",null,H(n.paramName),1),y(r,{effect:"light","visible-arrow":!1,"popper-class":"switches popper-class-text-tip",placement:"right"},{content:v(()=>[k(H(n.desc),1)]),default:v(()=>[n.desc?(C(),R("i",zo)):F("",!0)]),_:1})]),y(f,{disabled:n.disabled,modelValue:s.switchValue,"onUpdate:modelValue":e[0]||(e[0]=a=>s.switchValue=a),onChange:i.setValue,"active-color":"#134CFF","inactive-color":"#C0C6CF"},null,8,["disabled","modelValue","onChange"])])}const qo=Y(Ho,[["render",Ko],["__scopeId","data-v-f2836aab"]]);const Jo={name:"ModelTools",props:{disableOperate:{type:Boolean,default:!1},showTools:{type:Array,default:()=>[ce.WEB_SEARCH]},defaultOpenedTools:{type:Array,default:()=>[]}},components:{Switches:qo},computed:{webSearch(){return this.toolData[ce.WEB_SEARCH]}},data(){return{TOOLS_TYPE:ce,multiwheel:!1,toolData:{[ce.WEB_SEARCH]:{switchValue:!1,paramName:"网页检索",desc:"可以进行网页搜索，然后将搜索结果传递给大模型进行进一步的生成和处理"}}}},mounted(){this.defaultOpenedTools.forEach(t=>{this.setSwitchValue(t,!0)})},destroyed(){this.$emit("onChooseTool","")},methods:{setSwitchValue(t,e){const n=Object.keys(this.toolData).find(o=>this.toolData[o].switchValue);n&&(this.toolData[n].switchValue=!1),this.$nextTick(()=>{this.toolData[t].switchValue=e}),this.$emit("onChooseTool",e?t:"")}}},Zo={class:"params-comps"};function Xo(t,e,n,o,s,i){const r=O("Switches");return C(),R("div",Zo,[n.showTools.includes(s.TOOLS_TYPE.WEB_SEARCH)?(C(),ee(r,{key:0,paramName:i.webSearch.paramName,desc:i.webSearch.desc,value:i.webSearch.switchValue,disabled:n.disableOperate,onSetValue:e[0]||(e[0]=f=>i.setSwitchValue(s.TOOLS_TYPE.WEB_SEARCH,f))},null,8,["paramName","desc","value","disabled"])):F("",!0)])}const $o=Y(Jo,[["render",Xo],["__scopeId","data-v-a78dbd4c"]]);const ei={name:"OperatorPanel",inheritAttrs:!1,props:{panelParams:{type:Object,default:()=>{}},isConnected:{type:Boolean,default:!1}},components:{SystemPrompt:ko,VideoBox:jo,ModelTools:$o},watch:{responseType:{handler(t){this.$emit("onResponseTypeChange",t)},immediate:!0},apiKey:{handler(t){this.$emit("onApiKeyChange",t)},immediate:!0}},data(){return{apiKey:"",RESPONSE_TYPE:De,showTools:[ce.WEB_SEARCH],modelId:"glm_realtime",modelList:[{label:"GLM-Realtime",value:"glm_realtime"}],responseType:De.AUDIO}},methods:{updateInstructions(t){this.panelParams.instructions=t},onChooseTool(t){this.panelParams.tools=[],this.panelParams.beta_fields.auto_search=!1,t===ce.WEB_SEARCH&&(this.panelParams.beta_fields.auto_search=!0),console.log("--ModelTrialCenter--currentTool--",t)}}},ti={class:"operator-panel tl"},ni={class:"flex flex-x-start flex-y-center"},si={class:"flex flex-x-start flex-y-center"},oi={class:"flex flex-x-start flex-y-center"},ii={class:"flex flex-x-start flex-y-center"};function ri(t,e,n,o,s,i){const r=O("el-tooltip"),f=O("el-input"),a=O("el-form-item"),d=O("el-option"),c=O("el-select"),u=O("VideoBox"),l=O("SystemPrompt"),p=O("el-radio"),S=O("el-radio-group"),A=O("ModelTools"),D=O("el-form");return C(),R("div",ti,[y(D,{model:n.panelParams,ref:"ruleForm","label-width":"200px",class:"operator-panel__ruleForm"},{default:v(()=>[y(a,null,{label:v(()=>[m("div",ni,[e[6]||(e[6]=m("h4",null,"APIKEY",-1)),y(r,{effect:"light","visible-arrow":!1,"popper-class":"popper-class-text-tip",placement:"right"},{content:v(()=>e[4]||(e[4]=[k(" 用于调用模型的APIKEY，请前往 "),m("a",{href:"https://open.bigmodel.cn/usercenter/proj-mgmt/apikeys",target:"_blank"},"开放平台",-1),k(" 申请 ")])),default:v(()=>[e[5]||(e[5]=m("i",{class:"iconfont icon-info1 pointer"},null,-1))]),_:1})])]),default:v(()=>[y(f,{modelValue:s.apiKey,"onUpdate:modelValue":e[0]||(e[0]=b=>s.apiKey=b),placeholder:"请输入APIKEY",disabled:n.isConnected},null,8,["modelValue","disabled"])]),_:1}),y(a,{label:"模型",prop:"media_type"},{default:v(()=>[y(c,{modelValue:s.modelId,"onUpdate:modelValue":e[1]||(e[1]=b=>s.modelId=b),placeholder:"请选择",disabled:n.isConnected},{default:v(()=>[(C(!0),R(se,null,Ie(s.modelList,b=>(C(),ee(d,{key:b.value,label:b.label,value:b.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),y(a,{prop:"video_chunck"},{label:v(()=>[m("div",si,[e[9]||(e[9]=m("h4",null,"视频画面",-1)),y(r,{effect:"light","visible-arrow":!1,"popper-class":"popper-class-text-tip",placement:"right"},{content:v(()=>e[7]||(e[7]=[k(" 当前实时的视频画面，发送音频时会将视频的片段通过图片帧发送给模型进行推理 ")])),default:v(()=>[e[8]||(e[8]=m("i",{class:"iconfont icon-info1 pointer"},null,-1))]),_:1})])]),default:v(()=>[y(u,ln(t.$attrs,{extractFrameRate:500}),null,16)]),_:1}),y(a,{prop:"instructions"},{default:v(()=>[y(l,{instructions:n.panelParams.instructions,disabled:n.isConnected,onOnUpdateInstructions:i.updateInstructions},null,8,["instructions","disabled","onOnUpdateInstructions"])]),_:1}),y(a,{prop:"beta_fields.chat_mode"},{label:v(()=>[m("div",oi,[e[12]||(e[12]=m("h4",null,"输入类型",-1)),y(r,{effect:"light","visible-arrow":!1,"popper-class":"popper-class-text-tip",placement:"right"},{content:v(()=>e[10]||(e[10]=[m("div",{innerHTML:"自动发送：未检测到语音输入或关闭麦克风时发送音频<br />智能判断：模型自动进行说话检测、打断判断，自动发送音视频内容"},null,-1)])),default:v(()=>[e[11]||(e[11]=m("i",{class:"iconfont icon-info1 pointer"},null,-1))]),_:1})])]),default:v(()=>[y(S,{class:"base-radio-group",modelValue:n.panelParams.turn_detection.type,"onUpdate:modelValue":e[2]||(e[2]=b=>n.panelParams.turn_detection.type=b),disabled:n.isConnected},{default:v(()=>[y(p,{value:"client_vad"},{default:v(()=>e[13]||(e[13]=[k("自动发送")])),_:1}),y(p,{value:"server_vad"},{default:v(()=>e[14]||(e[14]=[k("智能判断")])),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),y(a,{prop:"responseType"},{label:v(()=>[m("div",ii,[e[17]||(e[17]=m("h4",null,"输出格式",-1)),y(r,{effect:"light","visible-arrow":!1,"popper-class":"popper-class-text-tip",placement:"right"},{content:v(()=>e[15]||(e[15]=[m("div",{innerHTML:"音频：会输出音频和音频对应的文本结果<br />文本：仅输出音频对应的文本结果"},null,-1)])),default:v(()=>[e[16]||(e[16]=m("i",{class:"iconfont icon-info1 pointer"},null,-1))]),_:1})])]),default:v(()=>[y(S,{class:"base-radio-group",modelValue:s.responseType,"onUpdate:modelValue":e[3]||(e[3]=b=>s.responseType=b),disabled:n.isConnected},{default:v(()=>[y(p,{value:s.RESPONSE_TYPE.AUDIO},{default:v(()=>e[18]||(e[18]=[k("音频")])),_:1},8,["value"]),y(p,{value:s.RESPONSE_TYPE.TEXT},{default:v(()=>e[19]||(e[19]=[k("文本")])),_:1},8,["value"])]),_:1},8,["modelValue","disabled"])]),_:1}),y(a,{label:"模型工具",prop:"tools"},{default:v(()=>[y(A,{showTools:s.showTools,disableOperate:n.isConnected,onOnChooseTool:i.onChooseTool},null,8,["showTools","disableOperate","onOnChooseTool"])]),_:1})]),_:1},8,["model"])])}const ai=Y(ei,[["render",ri],["__scopeId","data-v-c6c4cbb4"]]);const li={name:"AudioVideoCall",data(){return{apiKey:"",clearSseTimer:null,resetSseTimer:null,videoType:J.VIDEO,isFirstOpenMedia:!0,isShowToolBar:!1,enableAudio:!1,enableVideo:!1,messageList:[],isConnecting:!1,isConnected:!1,panelParams:{turn_detection:{type:G.CLIENT_VAD},instructions:"",beta_fields:{chat_mode:"audio",tts_source:"e2e",auto_search:!1},output_audio_format:"mp3",input_audio_format:"wav",tools:[]},vadType:G.CLIENT_VAD,responseType:"",currentAudioBlob:null,currentVideoBlob:null,responseId:"",requestId:"",resFinished:!0,sendAudioLimit:1e4}},watch:{"panelParams.turn_detection.type":{handler(t){this.vadType=t},immediate:!0},"panelParams.beta_fields.chat_mode":{handler(){this.isConnected&&this.sessionUpdate()}},enableVideo(t){this.panelParams.beta_fields.chat_mode=t?Oe.VIDEO_PASSIVE:Oe.AUDIO}},methods:{responseTypeChange(t){this.responseType=t},clickMedia(t){const e=t===J.AUDIO?Oe.AUDIO:Oe.VIDEO_PASSIVE;this.panelParams.beta_fields.chat_mode=e,this.openWS(t)},openWS(t=J.AUDIO){if(!this.apiKey){this.$message.warning("请输入APIKEY！");return}if(this.sock&&this.sock.readyState!==WebSocket.CLOSED){console.log("WebSocket 连接已经打开");return}this.isConnecting=!0,this.isConnected=!1;const e=`wss://open.bigmodel.cn/api/paas/v4/realtime?Authorization=${this.apiKey}`;this.sock=new WebSocket(e),this.sock.onopen=()=>{this.isConnecting=!1,this.isConnected=!0,this.isShowToolBar=!0,console.log("%c Connection opened","color: #ff59ff")},this.sock.onmessage=n=>{this.handleWsResponse(n.data,t)},this.sock.onclose=()=>{this.isConnected=!1,this.currentAudioBlob=null,this.currentVideoBlob=null,console.log("%c Connection closed","color: #ff59ff")},this.sock.onerror=n=>{this.isConnecting=!1,this.isConnected=!1,this.$message.error("连接出错！"),console.log("%c Connection onerror","color: #ff59ff")}},closeWS(){this.sock&&this.sock.readyState===WebSocket.OPEN&&(this.sock.close(),this.sock=null)},handleWsResponse(t,e){var n;try{const o=JSON.parse(t);switch(o.type){case N.SESSION_CREATED:this.sessionUpdate();break;case N.SESSION_UPDATED:if(!this.isFirstOpenMedia)return;this.firstOpenMedia(e),this.isFirstOpenMedia=!1;break;case N.SPEECH_STARTED:this.vadType===G.SERVER_VAD&&this.$refs.refToolBar.handleVadStatus(!0),console.log("%c 响应事件-说话开始","color: green");break;case N.SPEECH_STOPPED:this.vadType===G.SERVER_VAD&&this.$refs.refToolBar.handleVadStatus(!1),console.log("%c 响应事件-说话结束","color: green");break;case N.COMMITED:this.requestId=o.item_id,this.addAudioVideoToList(this.requestId,this.currentAudioBlob,ne.CLIENT),this.vadType===G.CLIENT_VAD&&this.sendResponseCreate(),console.log("%c 响应事件-服务端收到提交的音频数据","color: green");break;case N.RESPONSE_CREATED:this.responseId=o.response.id,this.loopScrollToBotton(),console.log("%c 响应事件-回复已创建（开始调用模型）","color: green");break;case N.ASR_COMPLETED:this.addAudioTextToList(this.requestId,o.transcript,ne.CLIENT),console.log("%c 响应事件-用户输入音频的asr文本（异步返回）："+o.transcript,"color: green");break;case N.RESPONSE_AUDIO_TXT:this.addAudioTextToList(this.responseId,o.delta,ne.SERVER);break;case N.RESPONSE_AUDIO_TXT_DONE:break;case N.RESPONSE_AUDIO:this.addAudioVideoToList(this.responseId,o.delta,ne.SERVER),this.resFinished=!1,console.log("%c 响应事件-返回模型音频（delta 是一个 mp3 格式base64 编码的音频块）","color: green");break;case N.RESPONSE_AUDIO_DONE:this.updateResponsStatus(this.responseId,le.COMPLETE),this.resFinished=!0,console.log("%c 响应事件-结束回复（status字段表示response的状态completed, cancelled分别对应完成、取消）","color: green");break;case N.ERROR:this.updateResponsStatus(this.responseId,le.FAIL),o.error&&o.error.code==="1220"&&this.$message.error((n=o.error)==null?void 0:n.message),console.log("%c 响应事件-发生错误"+t,"color: red");break;default:break}}catch(o){console.log("---handleWsResponse-error---:",o)}},vadStatus(t){t&&(!this.resFinished&&this.vadType===G.CLIENT_VAD&&this.sendResponseCancel(),ie.emit("onStopAudio"))},async listenAudioData(t){if(t&&t.size>0){const e=await wt(t);this.pushAudioData(e)}},async audioData(t){t&&t.size>this.sendAudioLimit&&(this.currentAudioBlob=t,this.resFinished=!1,ie.emit("onStopAudio"),this.vadType===G.CLIENT_VAD&&this.sendCommit())},vedioData(t){t&&t.size>0&&(this.currentVideoBlob=new Blob([t],{type:"video/mp4"}))},async videoImage(t){if(t&&t.size>0){const e=await wt(t);this.pushVideoData(e)}},addAudioVideoToList(t,e,n){if(n===ne.SERVER){if(this.responseType===De.TEXT)return;const o=this.messageList.findIndex(s=>s.id===t);if(o!==-1){const s=this.messageList[o];s.audioData.push({data:e}),this.messageList.splice(o,1,{...s})}else this.messageList.push({id:t,type:n,responseType:this.responseType,answerStatus:le.OUTPUT,audioData:[{data:e}],textContent:[]}),this.scrollToBottom()}else e&&e.size>this.sendAudioLimit&&(this.messageList.push({id:t,type:n,videoUrlContent:this.currentVideoBlob?URL.createObjectURL(this.currentVideoBlob):null,audioUrl:URL.createObjectURL(e),textContent:[]}),this.currentVideoBlob=null,this.scrollToBottom(),console.log("---添加用户发送的音频到对话框--data?.size---:",e==null?void 0:e.size))},addAudioTextToList(t,e,n){if(!e)return;const o=this.messageList.findIndex(s=>s.id===t);if(o!==-1){const s=this.messageList[o];s.textContent.push(e),this.messageList.splice(o,1,{...s})}else n===ne.SERVER?this.messageList.push({id:t,type:n,responseType:this.responseType,answerStatus:le.OUTPUT,audioData:[],textContent:[e]}):this.messageList.push({id:t,type:n,audioUrl:"",textContent:[e]}),this.scrollToBottom()},updateResponsStatus(t,e){const n=this.messageList.findIndex(o=>o.id===t);if(n!==-1){const o=this.messageList[n];o.answerStatus=e,this.messageList.splice(n,1,{...o})}},sendCommit(){const t={type:N.COMMIT,client_timestamp:Date.now()};this.sendMessage(t),console.log("%c 推送事件-提交音频，标明说完话了。","color: green")},sendResponseCreate(){const t={type:N.RESPONSE_CREATE,client_timestamp:Date.now()};this.sendMessage(t),console.log("%c 推送事件-创建模型回复","color: green")},sendResponseCancel(){const t={type:N.RESPONSE_CANCEL,client_timestamp:Date.now()};this.sendMessage(t),console.log("%c 推送事件-取消模型调用","color: green")},sessionUpdate(){const t={event_id:"evt_fakeId",type:N.SESSION_UPDATE,session:this.panelParams};this.sendMessage(t),console.log("%c 推送事件-设置会话信息"+JSON.stringify(t),"color: green")},pushAudioData(t){const e={type:N.AUDIO_APPEND,client_timestamp:Date.now(),audio:t};this.sendMessage(e)},pushVideoData(t){const e={type:N.VIDEO_APPEND,client_timestamp:Date.now(),video_frame:t};this.sendMessage(e)},sendMessage(t){this.sock&&this.isConnected&&this.sock.send(JSON.stringify(t))},firstOpenMedia(t){t===J.AUDIO?this.$refs.refToolBar.handleAudio():this.openVideoOrScreen(t)},openVideoOrScreen(t){this.videoType=t,this.enableVideo=!0},clearAndConnect(){this.isFirstOpenMedia=!0,this.clearObjectURL(),this.messageList=[],this.openWS()},openVideoOrScreenSuccess(){this.$refs.refToolBar.openVideoOrScreenSuccess()},videoTrackEnded(){this.$refs.refToolBar.closeVideoOrScreen()},audioPermisError(){this.$message.error("请检查音频权限是否已打开！"),this.$refs.refToolBar.closeVideoOrScreen(),this.enableAudio=!1,this.closeWS()},openVideoError(){this.$message.error("请检查视频权限是否已打开！"),this.handlePermisError()},openScreenError(){this.handlePermisError()},handlePermisError(){this.$refs.refToolBar.closeVideoOrScreen(),this.enableAudio||this.closeWS()},clearObjectURL(){Array.isArray(this.messageList)&&this.messageList.forEach(t=>{t.audioUrl&&URL.revokeObjectURL(t.audioUrl),t.videoUrlContent&&URL.revokeObjectURL(t.videoUrlContent)})},loopScrollToBotton(){this.$refs.refMessageBox.loopScrollToBotton()},scrollToBottom(){this.$refs.refMessageBox.scrollToBottom()}},beforeDestroy(){this.clearObjectURL(),this.closeWS()},components:{MessageBox:vo,ToolBar:To,OperatorPanel:ai}},ci={class:"experience"},ui={class:"experience__content flex flex-x-between"},di={class:"experience__content__left"};function hi(t,e,n,o,s,i){const r=O("MessageBox"),f=O("ToolBar"),a=O("OperatorPanel");return C(),R("div",ci,[e[4]||(e[4]=m("div",{class:"experience__header flex flex-between"},[m("h3",null,"互动体验")],-1)),m("div",ui,[m("div",di,[y(r,{ref:"refMessageBox",class:K({"show-tool-bar":s.isShowToolBar}),messageList:s.messageList,isConnecting:s.isConnecting,isShowWelcome:!s.isShowToolBar,onOnClickMedia:i.clickMedia},null,8,["class","messageList","isConnecting","isShowWelcome","onOnClickMedia"]),_e(y(f,{ref:"refToolBar",isConnected:s.isConnected,vadType:s.vadType,enableVideo:s.enableVideo,onOnPermissionError:i.audioPermisError,onOnOpenVideoOrScreen:i.openVideoOrScreen,onOnCloseVideoOrScreen:e[0]||(e[0]=d=>s.enableVideo=!1),onOnDisconnect:i.closeWS,onOnClearAndConnect:i.clearAndConnect,onOnAudioData:i.audioData,onOnListenAudioData:i.listenAudioData,onOnVadStatus:i.vadStatus,onOnOpenAudio:e[1]||(e[1]=d=>s.enableAudio=!0),onOnCloseAudio:e[2]||(e[2]=d=>s.enableAudio=!1)},null,8,["isConnected","vadType","enableVideo","onOnPermissionError","onOnOpenVideoOrScreen","onOnDisconnect","onOnClearAndConnect","onOnAudioData","onOnListenAudioData","onOnVadStatus"]),[[Se,s.isShowToolBar]])]),y(a,{panelParams:s.panelParams,isConnected:s.isConnected,enableVideo:s.enableVideo,videoType:s.videoType,onOnOpenVideoSuccess:i.openVideoOrScreenSuccess,onOnOpenVideoError:i.openVideoError,onOnOpenScreenSuccess:i.openVideoOrScreenSuccess,onOnOpenScreenError:i.openScreenError,onOnVideoImage:i.videoImage,onOnVideoData:i.vedioData,onOnVideoTrackEnded:i.videoTrackEnded,onOnResponseTypeChange:i.responseTypeChange,onOnApiKeyChange:e[3]||(e[3]=d=>s.apiKey=d)},null,8,["panelParams","isConnected","enableVideo","videoType","onOnOpenVideoSuccess","onOnOpenVideoError","onOnOpenScreenSuccess","onOnOpenScreenError","onOnVideoImage","onOnVideoData","onOnVideoTrackEnded","onOnResponseTypeChange"])])])}const fi=Y(li,[["render",hi],["__scopeId","data-v-4cbd5cfb"]]),pi=[{path:"/",name:"Home",component:fi}],mi=gs({history:Wn(),routes:pi});const $e=cn(pn);$e.use(un);$e.use(mi);$e.mount("#app");
